<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ƒæ­²æ•¸å­¸å†’éšªå³¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        /* Island theme animations */
        #app > div {
            animation: waveIn 0.8s ease-out;
        }
        @keyframes waveIn {
            0% { opacity: 0; transform: translateY(30px) scale(0.9); }
            50% { transform: translateY(-10px) scale(1.02); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        /* Wave animation for water effect */
        .wave {
            animation: wave 3s ease-in-out infinite;
        }
        @keyframes wave {
            0%, 100% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(-10px) translateY(-5px); }
            75% { transform: translateX(10px) translateY(5px); }
        }
        /* Treasure chest sparkle */
        .sparkle-treasure {
            animation: sparkle 1.5s ease-in-out infinite;
        }
        @keyframes sparkle {
            0%, 100% { opacity: 1; filter: brightness(1); }
            50% { opacity: 0.8; filter: brightness(1.3); }
        }
        /* Boat floating animation */
        .boat-float {
            animation: float 4s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }
        /* Palm tree sway */
        .palm-sway {
            animation: sway 5s ease-in-out infinite;
            transform-origin: bottom center;
        }
        @keyframes sway {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        /* Question and option text sizes */
        .question-text {
            font-size: 1.75rem;
            line-height: 2.25rem;
        }
        .option-text {
            font-size: 1.5rem;
        }
        @media (min-width: 640px) {
            .question-text {
                font-size: 2rem;
                line-height: 2.5rem;
            }
            .option-text {
                font-size: 1.75rem;
            }
        }
        /* Coin spin animation */
        .coin-spin {
            animation: coinSpin 2s linear infinite;
        }
        @keyframes coinSpin {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }
        /* Island gradient background */
        .island-bg {
            background: linear-gradient(to bottom, #87CEEB 0%, #98D8E8 40%, #F5DEB3 70%, #D2B48C 100%);
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app" class="min-h-screen p-4">
        <!-- The quiz will be rendered here by JavaScript -->
    </div>

    <script>
        // State variables
        let currentQuestionIndex = 0;
        let answers = {};
        let showResult = false;
        let startTime = Date.now();
        let treasureCoins = 0; // æ”¶é›†çš„å¯¶è—é‡‘å¹£
        let islandProgress = 0; // å³¶å¶¼æ¢ç´¢é€²åº¦

        // Adventure-themed questions
        const questions = [
            // è¨ˆç®— (4é¡Œ) - æµ·ç›œå¯¶è—ä¸»é¡Œ
            { category: "ğŸ§® è¨ˆç®—", color: "bg-yellow-100 border-yellow-400", question: "æµ·ç›œæ‰¾åˆ°28å€‹é‡‘å¹£ï¼Œåˆæ‰¾åˆ°16å€‹ï¼Œç¸½å…±æœ‰å¹¾å€‹ï¼Ÿ", options: ["42", "43", "44", "45"], correct: 2, type: "calculation", explanation: "28 + 16 = 28 + 10 + 6 = 38 + 6 = 44å€‹é‡‘å¹£ï¼ğŸ’°", coins: 3 },
            { category: "ğŸ§® è¨ˆç®—", color: "bg-yellow-100 border-yellow-400", question: "å¯¶ç®±è£¡æœ‰63é¡†çç ï¼Œé€çµ¦æœ‹å‹25é¡†ï¼Œé‚„å‰©å¹¾é¡†ï¼Ÿ", options: ["36", "37", "38", "39"], correct: 2, type: "calculation", explanation: "63 - 25 = 63 - 20 - 5 = 43 - 5 = 38é¡†çç ï¼ğŸ’", coins: 3 },
            { category: "ğŸ§® è¨ˆç®—", color: "bg-yellow-100 border-yellow-400", question: "æ¯è‰˜èˆ¹è¼‰7å€‹äººï¼Œ4è‰˜èˆ¹å…±è¼‰å¹¾äººï¼Ÿ", options: ["26", "27", "28", "29"], correct: 2, type: "calculation", explanation: "7 Ã— 4 = 7 + 7 + 7 + 7 = 28äººï¼â›µ", coins: 3 },
            { category: "ğŸ§® è¨ˆç®—", color: "bg-yellow-100 border-yellow-400", question: "å³¶ä¸ŠåŸæœ‰45éš»çŒ´å­ï¼Œèµ°äº†ä¸€äº›å¾Œå‰©29éš»ï¼Œèµ°äº†å¹¾éš»ï¼Ÿ", options: ["14", "15", "16", "17"], correct: 2, type: "calculation", explanation: "45 - ? = 29ï¼Œæ‰€ä»¥ ? = 45 - 29 = 16éš»ï¼ğŸ’", coins: 3 },
            
            // å¹¾ä½• (4é¡Œ) - å³¶å¶¼åœ°åœ–ä¸»é¡Œ
            { category: "ğŸ”º å¹¾ä½•", color: "bg-green-100 border-green-400", question: "å¯¶è—åœ°åœ–æ˜¯ä»€éº¼å½¢ç‹€ï¼Ÿï¼ˆæç¤ºï¼šæœ‰4æ¢ç›¸ç­‰çš„é‚Šï¼‰", options: ["é•·æ–¹å½¢", "æ­£æ–¹å½¢", "ä¸‰è§’å½¢", "åœ“å½¢"], correct: 1, type: "geometry", explanation: "æ­£æ–¹å½¢çš„4æ¢é‚Šéƒ½ä¸€æ¨£é•·ï¼Œåƒå®Œç¾çš„å¯¶è—åœ°åœ–ï¼ğŸ—ºï¸", coins: 2 },
            { category: "ğŸ”º å¹¾ä½•", color: "bg-green-100 border-green-400", question: "å¾å°å³¶æœ€é«˜çš„å±±é ‚å¾€ä¸‹çœ‹ï¼Œçœ‹åˆ°çš„å³¶å¶¼é‚Šç·£åƒä»€éº¼å½¢ç‹€ï¼Ÿ", options: ["æ­£æ–¹å½¢", "ä¸‰è§’å½¢", "åœ“å½¢", "æ˜Ÿå½¢"], correct: 2, type: "geometry", explanation: "å°å³¶å¾ä¸Šå¾€ä¸‹çœ‹é€šå¸¸æ˜¯åœ“å½¢æˆ–æ©¢åœ“å½¢ï¼ğŸï¸", coins: 2 },
            { category: "ğŸ”º å¹¾ä½•", color: "bg-green-100 border-green-400", question: "æ­å¸³ç¯·éœ€è¦å¹¾æ ¹æ”¯æŸ±æ‰æœ€ç©©ï¼Ÿï¼ˆæç¤ºï¼šä¸‰è§’å½¢ï¼‰", options: ["2æ ¹", "3æ ¹", "4æ ¹", "5æ ¹"], correct: 1, type: "geometry", explanation: "3æ ¹æ”¯æŸ±å½¢æˆä¸‰è§’å½¢ï¼Œæ˜¯æœ€ç©©å›ºçš„çµæ§‹ï¼â›º", coins: 2 },
            { category: "ğŸ”º å¹¾ä½•", color: "bg-green-100 border-green-400", question: "æ¤°å­å¾æ¨¹ä¸Šæ‰ä¸‹ä¾†èµ°ä»€éº¼è·¯ç·šï¼Ÿ", options: ["å½æ›²ç·š", "ç›´ç·š", "åœ“åœˆ", "Zå­—å½¢"], correct: 1, type: "geometry", explanation: "é‡åŠ›è®“æ¤°å­ç›´ç›´å¾€ä¸‹æ‰ï¼Œèµ°ç›´ç·šæœ€å¿«ï¼ğŸ¥¥", coins: 2 },
            
            // æ‡‰ç”¨ (4é¡Œ) - å³¶å¶¼ç”Ÿæ´»ä¸»é¡Œ
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-blue-100 border-blue-400", question: "æ¢éšªéšŠæœ‰24ç“¶æ°´ï¼Œæ¯å¤©å–6ç“¶ï¼Œå¯ä»¥å–å¹¾å¤©ï¼Ÿ", options: ["3å¤©", "4å¤©", "5å¤©", "6å¤©"], correct: 1, type: "application", explanation: "24 Ã· 6 = 4å¤©ã€‚æ¯å¤©6ç“¶ï¼Œ4å¤©å‰›å¥½å–å®Œï¼ğŸ’§", coins: 4 },
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-blue-100 border-blue-400", question: "é€ æœ¨ç­éœ€è¦15æ ¹æœ¨é ­ï¼Œå·²æœ‰9æ ¹ï¼Œé‚„è¦æ’¿å¹¾æ ¹ï¼Ÿ", options: ["4æ ¹", "5æ ¹", "6æ ¹", "7æ ¹"], correct: 2, type: "application", explanation: "15 - 9 = 6æ ¹ã€‚å†æ’¿6æ ¹å°±èƒ½é€ æœ¨ç­å‡ºæµ·äº†ï¼ğŸªµ", coins: 4 },
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-blue-100 border-blue-400", question: "å³¶ä¸Šæ—¥å‡º6é»ï¼Œæ—¥è½6é»ï¼Œç™½å¤©æœ‰å¹¾å°æ™‚ï¼Ÿ", options: ["10å°æ™‚", "11å°æ™‚", "12å°æ™‚", "13å°æ™‚"], correct: 2, type: "application", explanation: "å¾æ—©ä¸Š6é»åˆ°æ™šä¸Š6é»ï¼Œç¸½å…±12å°æ™‚ï¼â˜€ï¸", coins: 4 },
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-blue-100 border-blue-400", question: "5å€‹æ¢éšªå®¶å¹³åˆ†40å€‹æ¤°å­ï¼Œæ¯äººåˆ†å¹¾å€‹ï¼Ÿ", options: ["6å€‹", "7å€‹", "8å€‹", "9å€‹"], correct: 2, type: "application", explanation: "40 Ã· 5 = 8å€‹ã€‚æ¯äºº8å€‹æ¤°å­ï¼Œå…¬å¹³åˆ†é…ï¼ğŸ¥¥", coins: 4 },
            
            // ä»£æ•¸ (3é¡Œ) - ç¥ç§˜ç¬¦è™Ÿä¸»é¡Œ
            { category: "ğŸ¨ ä»£æ•¸", color: "bg-purple-100 border-purple-400", question: "å¤è€çŸ³ç¢‘ï¼šğŸŒŸ, ğŸŒŸğŸŒŸ, ğŸŒŸğŸŒŸğŸŒŸ, ?", options: ["ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ", "ğŸŒŸğŸŒŸ", "ğŸŒŸ", "ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ"], correct: 0, type: "algebra", explanation: "æ¯æ¬¡å¤šä¸€å€‹æ˜Ÿæ˜Ÿï¼š1, 2, 3, 4å€‹æ˜Ÿæ˜Ÿï¼âœ¨", coins: 5 },
            { category: "ğŸ¨ ä»£æ•¸", color: "bg-purple-100 border-purple-400", question: "ç¥ç§˜æ–¹ç¨‹å¼ï¼šğŸº + ğŸº + ğŸº = 21ï¼Œä¸€å€‹ğŸºä»£è¡¨ï¼Ÿ", options: ["5", "6", "7", "8"], correct: 2, type: "algebra", explanation: "3å€‹ç›¸åŒçš„ğŸº = 21ï¼Œæ‰€ä»¥ğŸº = 21 Ã· 3 = 7ï¼ğŸº", coins: 5 },
            { category: "ğŸ¨ ä»£æ•¸", color: "bg-purple-100 border-purple-400", question: "é­”æ³•æ•¸å­—ï¼š10, 20, 30, ?", options: ["35", "40", "45", "50"], correct: 1, type: "algebra", explanation: "æ¯æ¬¡åŠ 10ï¼š10â†’20â†’30â†’40ï¼Œé€™æ˜¯10çš„å€æ•¸ï¼ğŸ”®", coins: 5 },
            
            // çµ„åˆ (3é¡Œ) - æ¢éšªæº–å‚™ä¸»é¡Œ
            { category: "ğŸ§© çµ„åˆ", color: "bg-orange-100 border-orange-400", question: "æœ‰3é ‚å¸½å­ã€2å€‹èƒŒåŒ…ï¼Œæœ‰å¹¾ç¨®æ­é…æ–¹å¼ï¼Ÿ", options: ["5ç¨®", "6ç¨®", "7ç¨®", "8ç¨®"], correct: 1, type: "combination", explanation: "æ¯é ‚å¸½å­é…æ¯å€‹èƒŒåŒ…ï¼š3 Ã— 2 = 6ç¨®çµ„åˆï¼ğŸ’", coins: 3 },
            { category: "ğŸ§© çµ„åˆ", color: "bg-orange-100 border-orange-400", question: "4ä½æ¢éšªå®¶è¦é¸å‡ºéšŠé•·å’Œå‰¯éšŠé•·ï¼Œæœ‰å¹¾ç¨®é¸æ³•ï¼Ÿ", options: ["8ç¨®", "10ç¨®", "12ç¨®", "14ç¨®"], correct: 2, type: "combination", explanation: "éšŠé•·4é¸1ï¼Œå‰¯éšŠé•·å¾å‰©ä¸‹3äººé¸ï¼š4 Ã— 3 = 12ç¨®ï¼ğŸ‘¥", coins: 3 },
            { category: "ğŸ§© çµ„åˆ", color: "bg-orange-100 border-orange-400", question: "å¯¶ç®±å¯†ç¢¼æ˜¯2å€‹ä¸åŒæ•¸å­—(1-3)ï¼Œæœ‰å¹¾ç¨®å¯èƒ½ï¼Ÿ", options: ["4ç¨®", "5ç¨®", "6ç¨®", "7ç¨®"], correct: 2, type: "combination", explanation: "12,13,21,23,31,32å…±6ç¨®ï¼ä¸èƒ½é‡è¤‡ï¼ğŸ”", coins: 3 },
            
            // æ•¸æ„Ÿ (4é¡Œ) - å³¶å¶¼æ¸¬é‡ä¸»é¡Œ
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-pink-100 border-pink-400", question: "å³¶å¶¼å‘¨é•·198å…¬å°ºï¼Œæœ€æ¥è¿‘å¤šå°‘ï¼Ÿ", options: ["100å…¬å°º", "150å…¬å°º", "200å…¬å°º", "250å…¬å°º"], correct: 2, type: "number_sense", explanation: "198æœ€æ¥è¿‘200ï¼Œåªå·®2å…¬å°ºï¼ğŸ“", coins: 2 },
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-pink-100 border-pink-400", question: "æŠŠå³¶åˆ†æˆ5å€ï¼Œæ¢ç´¢äº†2å€ï¼Œæ¢ç´¢äº†å¹¾åˆ†ä¹‹å¹¾ï¼Ÿ", options: ["1/5", "2/5", "3/5", "4/5"], correct: 1, type: "number_sense", explanation: "ç¸½å…±5å€ï¼Œæ¢ç´¢2å€ï¼Œå°±æ˜¯2/5ï¼ˆäº”åˆ†ä¹‹äºŒï¼‰ï¼ğŸ—ºï¸", coins: 2 },
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-pink-100 border-pink-400", question: "å“ªè¢‹å¯¶çŸ³æœ€é‡ï¼Ÿ", options: ["0.5å…¬æ–¤", "499å…¬å…‹", "åŠå…¬æ–¤", "0.51å…¬æ–¤"], correct: 3, type: "number_sense", explanation: "0.51å…¬æ–¤=510å…¬å…‹ï¼Œæ¯”å…¶ä»–éƒ½é‡ï¼ğŸ’", coins: 2 },
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-pink-100 border-pink-400", question: "ç”¨4ã€7ã€1æ’å‡ºæœ€å°çš„ä¸‰ä½æ•¸æ˜¯ï¼Ÿ", options: ["147", "174", "417", "471"], correct: 0, type: "number_sense", explanation: "è¦æœ€å°ï¼Œç™¾ä½æ”¾1ï¼Œåä½æ”¾4ï¼Œå€‹ä½æ”¾7ï¼š147ï¼ğŸ”¢", coins: 2 }
        ];

        const appContainer = document.getElementById('app');

        // Handle answer selection
        function handleAnswer(selectedIndex) {
            answers[currentQuestionIndex] = selectedIndex;
            
            // ç­”å°ç²å¾—é‡‘å¹£
            if (selectedIndex === questions[currentQuestionIndex].correct) {
                treasureCoins += questions[currentQuestionIndex].coins || 1;
            }
            
            // æ›´æ–°å³¶å¶¼æ¢ç´¢é€²åº¦
            islandProgress = ((currentQuestionIndex + 1) / questions.length) * 100;
            
            renderApp();

            if (currentQuestionIndex < questions.length - 1) {
                setTimeout(() => {
                    currentQuestionIndex++;
                    renderApp();
                }, 1600);
            } else {
                setTimeout(() => {
                    showResult = true;
                    renderApp();
                }, 1600);
            }
        }

        // Restart quiz
        function restartQuiz() {
            currentQuestionIndex = 0;
            answers = {};
            showResult = false;
            startTime = Date.now();
            treasureCoins = 0;
            islandProgress = 0;
            renderApp();
        }

        // Calculate results
        function calculateResults() {
            const results = {
                calculation: { correct: 0, total: 0 },
                geometry: { correct: 0, total: 0 },
                application: { correct: 0, total: 0 },
                algebra: { correct: 0, total: 0 },
                combination: { correct: 0, total: 0 },
                number_sense: { correct: 0, total: 0 }
            };

            let perfectCategories = [];

            questions.forEach((question, index) => {
                const type = question.type;
                results[type].total++;
                if (answers[index] === question.correct) {
                    results[type].correct++;
                }
            });

            // æ‰¾å‡ºæ»¿åˆ†çš„é¡åˆ¥
            Object.keys(results).forEach(key => {
                if (results[key].correct === results[key].total && results[key].total > 0) {
                    perfectCategories.push(key);
                }
            });

            results.perfectCategories = perfectCategories;
            return results;
        }

        // Main render function
        function renderApp() {
            // Island theme gradient background
            document.body.className = 'island-bg';

            if (showResult) {
                renderResultScreen();
            } else {
                renderQuestionScreen();
            }
        }

        // Render question screen
        function renderQuestionScreen() {
            const question = questions[currentQuestionIndex];
            const selectedAnswer = answers[currentQuestionIndex];
            const isAnswered = selectedAnswer !== undefined;

            const optionsHtml = question.options.map((option, index) => {
                let buttonClass = 'bg-white bg-opacity-90 border-gray-300 text-gray-700 hover:shadow-xl cursor-pointer hover:bg-opacity-100';
                let icon = '';

                if (isAnswered) {
                    if (index === question.correct) {
                        buttonClass = 'bg-green-200 border-green-500 text-green-800 shadow-xl';
                        icon = '<span class="inline-block ml-2">âœ…</span>';
                    } else if (index === selectedAnswer) {
                        buttonClass = 'bg-red-200 border-red-500 text-red-800';
                        icon = '<span class="inline-block ml-2">âŒ</span>';
                    } else {
                        buttonClass = 'bg-gray-100 border-gray-300 text-gray-500 opacity-60';
                    }
                }

                return `
                    <button
                        onclick="${isAnswered ? '' : `handleAnswer(${index})`}"
                        ${isAnswered ? 'disabled' : ''}
                        class="p-4 sm:p-5 rounded-2xl option-text font-bold border-3 transition-all duration-300 transform hover:scale-105 ${buttonClass}"
                    >
                        ${option} ${icon}
                    </button>
                `;
            }).join('');

            // å³¶å¶¼åœ°åœ–é€²åº¦
            const islandMap = `
                <div class="relative w-full h-16 mb-4">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-300 via-green-300 to-yellow-300 rounded-full opacity-30"></div>
                    <div class="absolute inset-0 flex items-center px-4">
                        <div class="w-full bg-white bg-opacity-50 rounded-full h-2">
                            <div class="bg-gradient-to-r from-blue-500 to-green-500 h-2 rounded-full transition-all duration-1000"
                                 style="width: ${islandProgress}%"></div>
                        </div>
                        <span class="absolute boat-float text-3xl" style="left: ${Math.max(5, islandProgress - 5)}%">â›µ</span>
                    </div>
                    <div class="absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl sparkle-treasure">ğŸï¸</div>
                </div>
            `;

            appContainer.innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <!-- Adventure Header -->
                    <div class="text-center mb-4">
                        <div class="inline-block bg-gradient-to-r from-blue-500 to-green-500 text-white px-6 py-3 rounded-full font-bold text-xl shadow-lg wave">
                            ğŸï¸ æ•¸å­¸å†’éšªå³¶ ğŸ—ºï¸
                        </div>
                    </div>

                    <!-- Treasure Counter -->
                    <div class="text-center mb-4">
                        <span class="inline-block bg-yellow-200 text-yellow-800 px-4 py-2 rounded-full font-bold">
                            <span class="coin-spin inline-block">ğŸ’°</span> å¯¶è—é‡‘å¹£ï¼š${treasureCoins}
                        </span>
                    </div>

                    <!-- Island Progress Map -->
                    ${islandMap}

                    <div class="text-center text-white drop-shadow-lg text-xl mb-4 font-bold">
                        ğŸ´â€â˜ ï¸ ç¬¬ ${currentQuestionIndex + 1} é—œ / å…± ${questions.length} é—œ
                    </div>

                    <!-- Question Card -->
                    <div class="${question.color} rounded-3xl shadow-2xl p-6 sm:p-8 border-4 transform hover:rotate-1 transition-all duration-300">
                        <div class="text-center mb-6">
                            <div class="text-2xl sm:text-3xl font-bold text-gray-700 mb-4 flex items-center justify-center gap-2">
                                <span class="palm-sway inline-block">${question.category.split(' ')[0]}</span>
                                <span>${question.category.split(' ')[1]}</span>
                            </div>
                            <div class="question-text font-bold text-gray-800 mb-6 min-h-[6rem] flex items-center justify-center">
                                ${question.question}
                            </div>
                        </div>

                        <!-- Answer Options -->
                        <div class="grid grid-cols-2 gap-4">
                            ${optionsHtml}
                        </div>

                        ${isAnswered ? `
                            <div class="mt-6">
                                <div class="text-center text-3xl sm:text-4xl font-bold mb-2">
                                    ${selectedAnswer === question.correct ? 
                                        `ğŸ‰ æ‰¾åˆ°å¯¶è—ï¼+${question.coins}ğŸ’°` 
                                        : "ğŸ’ª ç¹¼çºŒæ¢ç´¢ï¼"}
                                </div>
                                ${question.explanation ? `
                                    <div class="bg-white bg-opacity-70 rounded-xl p-4 mt-4 border-2 border-blue-300">
                                        <div class="text-base font-bold text-gray-700 mb-1">ğŸ§­ æ¢éšªç­†è¨˜ï¼š</div>
                                        <div class="text-base text-gray-700">${question.explanation}</div>
                                    </div>
                                ` : ''}
                                <div class="text-center text-lg text-gray-600 mt-2 font-semibold">
                                    ${currentQuestionIndex < questions.length - 1 ? 'èˆªå‘ä¸‹ä¸€å€‹å³¶å¶¼...' : 'è¿”å›åŸºåœ°çµ±è¨ˆå¯¶è—...'}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        // Render result screen
        function renderResultScreen() {
            const results = calculateResults();
            const totalCorrect = Object.values(results).reduce((sum, r) => sum + r.correct, 0);
            const totalQuestions = questions.length;
            const scorePercentage = totalCorrect / totalQuestions;
            const timeTaken = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            
            let resultEmoji = "ğŸï¸";
            let resultMessage = "å†’éšªå®Œæˆï¼ä½ ç™¼ç¾äº†è¨±å¤šå¯¶è—ï¼";
            let titleRank = "è¦‹ç¿’æ¢éšªå®¶";

            if (scorePercentage >= 0.95) {
                resultEmoji = "ğŸ‘‘";
                resultMessage = "ä½ æˆç‚ºäº†å‚³èªªä¸­çš„å¯¶è—çµäººï¼";
                titleRank = "å‚³å¥‡æ¢éšªå®¶";
            } else if (scorePercentage >= 0.85) {
                resultEmoji = "ğŸ†";
                resultMessage = "å‡ºè‰²çš„å†’éšªï¼å¯¶è—æ»¿è¼‰è€Œæ­¸ï¼";
                titleRank = "è³‡æ·±æ¢éšªå®¶";
            } else if (scorePercentage >= 0.7) {
                resultEmoji = "â­";
                resultMessage = "å¾ˆæ£’çš„æ¢éšªï¼æ”¶ç©«è±å¯Œï¼";
                titleRank = "æ¢éšªå®¶";
            } else if (scorePercentage >= 0.5) {
                resultEmoji = "ğŸ—ºï¸";
                resultMessage = "ä¸éŒ¯çš„é–‹å§‹ï¼ç¹¼çºŒæ¢ç´¢å§ï¼";
                titleRank = "æ¢éšªå­¸å¾’";
            }

            // ç‰¹æ®Šæˆå°±åˆ¤å®š
            const achievements = [];
            if (treasureCoins >= 60) achievements.push("ğŸ’ å¯¶è—å¤§å¸«");
            if (timeTaken < 360) achievements.push("âš¡ ç¥é€Ÿèˆªæµ·å®¶");
            if (results.perfectCategories.length >= 2) achievements.push("ğŸ¯ ç²¾æº–å°èˆªå“¡");
            if (scorePercentage === 1) achievements.push("ğŸŒŸ å®Œç¾æ¢éšª");

            const categoryResultsHtml = Object.keys(results).filter(key => key !== 'perfectCategories').map(key => {
                const categoryMap = {
                    calculation: { name: "ğŸ§® è¨ˆç®—", icon: "ğŸ’°", style: "bg-yellow-50 border-yellow-300 text-yellow-700" },
                    geometry: { name: "ğŸ”º å¹¾ä½•", icon: "ğŸ—ºï¸", style: "bg-green-50 border-green-300 text-green-700" },
                    application: { name: "ğŸ›’ æ‡‰ç”¨", icon: "â›µ", style: "bg-blue-50 border-blue-300 text-blue-700" },
                    algebra: { name: "ğŸ¨ ä»£æ•¸", icon: "ğŸ”®", style: "bg-purple-50 border-purple-300 text-purple-700" },
                    combination: { name: "ğŸ§© çµ„åˆ", icon: "ğŸ’", style: "bg-orange-50 border-orange-300 text-orange-700" },
                    number_sense: { name: "ğŸ”¢ æ•¸æ„Ÿ", icon: "ğŸ§­", style: "bg-pink-50 border-pink-300 text-pink-700" },
                };
                const info = categoryMap[key];
                const percentage = results[key].total > 0 ? Math.round((results[key].correct / results[key].total) * 100) : 0;
                const isPerfect = results.perfectCategories.includes(key);
                
                return `
                    <div class="${info.style} p-4 rounded-2xl border-2 transform hover:scale-105 transition-all duration-200 relative overflow-hidden">
                        ${isPerfect ? '<div class="absolute top-0 right-0 text-2xl p-1">ğŸ‘‘</div>' : ''}
                        <div class="text-lg font-bold flex items-center gap-2">
                            <span class="text-2xl">${info.icon}</span>
                            <span>${info.name}</span>
                        </div>
                        <div class="text-2xl font-bold mt-1">${results[key].correct}/${results[key].total}</div>
                        <div class="text-sm">æ¢ç´¢æˆåŠŸç‡ ${percentage}%</div>
                        <div class="mt-2 bg-white bg-opacity-50 rounded-full h-3">
                            <div class="bg-gradient-to-r from-blue-400 to-green-400 h-3 rounded-full transition-all duration-1000" 
                                 style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');

            appContainer.innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white bg-opacity-95 rounded-3xl shadow-2xl p-8 text-center border-4 border-blue-300">
                        <div class="text-8xl mb-4">${resultEmoji}</div>
                        
                        <h2 class="text-4xl font-bold text-gray-800 mb-2">å†’éšªå®Œæˆï¼</h2>
                        
                        <div class="inline-block bg-gradient-to-r from-yellow-400 to-orange-400 text-white px-6 py-3 rounded-full font-bold text-xl mb-6 shadow-lg">
                            ğŸ… ${titleRank} ğŸ…
                        </div>
                        
                        <!-- ä¸»è¦æˆç¸¾ -->
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="bg-gradient-to-br from-blue-100 to-cyan-100 rounded-2xl p-4">
                                <div class="text-3xl mb-1">ğŸ¯</div>
                                <div class="text-sm text-gray-600">æ¢ç´¢æˆåŠŸ</div>
                                <div class="text-2xl font-bold text-blue-700">${totalCorrect}/${totalQuestions}</div>
                            </div>
                            <div class="bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl p-4">
                                <div class="text-3xl mb-1">ğŸ’°</div>
                                <div class="text-sm text-gray-600">å¯¶è—é‡‘å¹£</div>
                                <div class="text-2xl font-bold text-orange-700">${treasureCoins}æš</div>
                            </div>
                            <div class="bg-gradient-to-br from-green-100 to-emerald-100 rounded-2xl p-4">
                                <div class="text-3xl mb-1">â±ï¸</div>
                                <div class="text-sm text-gray-600">æ¢éšªæ™‚é–“</div>
                                <div class="text-2xl font-bold text-green-700">${minutes}:${seconds.toString().padStart(2, '0')}</div>
                            </div>
                        </div>

                        <!-- æˆå°±å¾½ç«  -->
                        ${achievements.length > 0 ? `
                            <div class="mb-6 p-4 bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl">
                                <div class="text-lg font-bold text-gray-700 mb-3">ğŸ† ç²å¾—æˆå°±</div>
                                <div class="flex flex-wrap justify-center gap-3">
                                    ${achievements.map(achievement => `
                                        <span class="inline-block bg-white px-4 py-2 rounded-full text-sm font-bold shadow-md">
                                            ${achievement}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <!-- å„å³¶å¶¼æ¢ç´¢æˆæœ -->
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6">
                           ${categoryResultsHtml}
                        </div>

                        <div class="text-2xl mb-6 font-bold text-gray-700">
                            ${resultMessage}
                        </div>

                        <button
                            onclick="restartQuiz()"
                            class="bg-gradient-to-r from-blue-500 to-green-500 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:shadow-lg transform hover:scale-105 transition-all duration-200 wave"
                        >
                            å†æ¬¡å‡ºèˆª â›µ
                        </button>
                    </div>
                </div>
            `;
        }

        // Start the quiz
        renderApp();

    </script>
</body>
</html>