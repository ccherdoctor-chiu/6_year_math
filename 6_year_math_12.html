<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ƒæ­²æ•¸å­¸æ¢ç´¢ä¹‹æ—…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        /* Smooth transitions and animations */
        #app > div {
            animation: slideIn 0.6s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        /* Pulse animation for theme badge */
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        /* Rainbow gradient animation */
        .rainbow-bg {
            background: linear-gradient(45deg, #ff6b6b, #f06595, #cc5de8, #845ef7, #5c7cfa, #339af0, #22b8cf, #20c997);
            background-size: 200% 200%;
            animation: rainbow 5s ease infinite;
        }
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        /* Question and option text sizes */
        .question-text {
            font-size: 1.75rem;
            line-height: 2.25rem;
        }
        .option-text {
            font-size: 1.5rem;
        }
        @media (min-width: 640px) {
            .question-text {
                font-size: 2rem;
                line-height: 2.5rem;
            }
            .option-text {
                font-size: 1.75rem;
            }
        }
        /* Star animation */
        .star-spin {
            animation: spin 3s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app" class="min-h-screen p-4">
        <!-- The quiz will be rendered here by JavaScript -->
    </div>

    <script>
        // State variables to manage the quiz
        let currentQuestionIndex = 0;
        let answers = {};
        let showResult = false;
        let startTime = Date.now();
        let streakCount = 0; // é€£çºŒç­”å°æ¬¡æ•¸

        // New set of quiz questions for 7-year-olds
        const questions = [
            // è¨ˆç®— (4é¡Œ) - ä¸åŒçš„è¨ˆç®—æŒ‘æˆ°
            { category: "ğŸ§® è¨ˆç®—", color: "bg-orange-100 border-orange-300", question: "23 + 19 = ?", options: ["40", "41", "42", "43"], correct: 2, type: "calculation", explanation: "23 + 19 = 23 + 20 - 1 = 43 - 1 = 42ã€‚å…ˆåŠ 20å†æ¸›1æ›´ç°¡å–®ï¼ğŸª" },
            { category: "ğŸ§® è¨ˆç®—", color: "bg-orange-100 border-orange-300", question: "50 - 27 = ?", options: ["21", "22", "23", "24"], correct: 2, type: "calculation", explanation: "50 - 27 = 50 - 30 + 3 = 20 + 3 = 23ã€‚æ¸›30å†åŠ å›3ï¼ğŸ¨" },
            { category: "ğŸ§® è¨ˆç®—", color: "bg-orange-100 border-orange-300", question: "6 + 6 + 6 + 6 = ?", options: ["22", "23", "24", "25"], correct: 2, type: "calculation", explanation: "4å€‹6ç›¸åŠ  = 6 Ã— 4 = 24ã€‚æˆ–åˆ†çµ„ç®—ï¼š(6+6) + (6+6) = 12 + 12 = 24ï¼ğŸ¯" },
            { category: "ğŸ§® è¨ˆç®—", color: "bg-orange-100 border-orange-300", question: "__ - 18 = 30ï¼Œç©ºæ ¼å¡«ä»€éº¼ï¼Ÿ", options: ["46", "47", "48", "49"], correct: 2, type: "calculation", explanation: "è¦æ‰¾ä»€éº¼æ•¸æ¸›18ç­‰æ–¼30ï¼Ÿ30 + 18 = 48ã€‚æª¢é©—ï¼š48 - 18 = 30 âœ“" },
            
            // å¹¾ä½• (4é¡Œ) - æ–°çš„ç©ºé–“æ¦‚å¿µ
            { category: "ğŸ”º å¹¾ä½•", color: "bg-cyan-100 border-cyan-300", question: "é•·æ–¹å½¢æœ‰å¹¾å€‹ç›´è§’ï¼Ÿ", options: ["2å€‹", "3å€‹", "4å€‹", "5å€‹"], correct: 2, type: "geometry", explanation: "é•·æ–¹å½¢çš„4å€‹è§’éƒ½æ˜¯90åº¦çš„ç›´è§’ï¼Œå°±åƒ4å€‹Lå½¢ï¼ğŸ“" },
            { category: "ğŸ”º å¹¾ä½•", color: "bg-cyan-100 border-cyan-300", question: "å“ªå€‹ç«‹é«”åœ–å½¢æ»¾å¾—æœ€å¿«ï¼Ÿ", options: ["æ­£æ–¹é«”", "åœ“çƒ", "åœ“æŸ±", "é‡‘å­—å¡”"], correct: 1, type: "geometry", explanation: "åœ“çƒæ²’æœ‰é‚Šå’Œè§’ï¼Œå¯ä»¥å‘ä»»ä½•æ–¹å‘é †æš¢æ»¾å‹•ï¼Œæœ€å¿«ï¼âš½" },
            { category: "ğŸ”º å¹¾ä½•", color: "bg-cyan-100 border-cyan-300", question: "å‰ªä¸€å€‹åœ“å½¢å°æ‘º2æ¬¡ï¼Œå±•é–‹æœ‰å¹¾æ¢æ‘ºç—•ï¼Ÿ", options: ["1æ¢", "2æ¢", "3æ¢", "4æ¢"], correct: 1, type: "geometry", explanation: "å°æ‘º1æ¬¡æœ‰1æ¢ç—•ï¼Œå†å°æ‘º1æ¬¡åˆæœ‰1æ¢ï¼Œå…±2æ¢æ‘ºç—•åå­—äº¤å‰ï¼âœ‚ï¸" },
            { category: "ğŸ”º å¹¾ä½•", color: "bg-cyan-100 border-cyan-300", question: "å“ªå…©å€‹åœ–å½¢å¯ä»¥æ‹¼æˆé•·æ–¹å½¢ï¼Ÿ", options: ["2å€‹åœ“å½¢", "2å€‹æ­£ä¸‰è§’å½¢", "2å€‹ç›¸åŒç›´è§’ä¸‰è§’å½¢", "2å€‹äº”è§’å½¢"], correct: 2, type: "geometry", explanation: "å…©å€‹ç›¸åŒçš„ç›´è§’ä¸‰è§’å½¢å¯ä»¥æ‹¼æˆä¸€å€‹é•·æ–¹å½¢ï¼ŒåƒæŠŠä¸‰æ˜æ²»åˆ‡ä¸€åŠï¼ğŸ¥ª" },
            
            // æ‡‰ç”¨ (4é¡Œ) - æ–°çš„ç”Ÿæ´»æƒ…å¢ƒ
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-lime-100 border-lime-300", question: "ç­ä¸Š30äººï¼Œç”·ç”Ÿæ¯”å¥³ç”Ÿå¤š4äººï¼Œå¥³ç”Ÿæœ‰å¹¾äººï¼Ÿ", options: ["11äºº", "12äºº", "13äºº", "14äºº"], correct: 2, type: "application", explanation: "è¨­å¥³ç”Ÿxäººï¼Œç”·ç”Ÿx+4äººã€‚x + (x+4) = 30ï¼Œ2x = 26ï¼Œx = 13äººï¼ğŸ‘«" },
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-lime-100 border-lime-300", question: "ä¸€é€±å­˜10å…ƒï¼Œè¦å­˜æ»¿80å…ƒéœ€è¦å¹¾é€±ï¼Ÿ", options: ["6é€±", "7é€±", "8é€±", "9é€±"], correct: 2, type: "application", explanation: "80 Ã· 10 = 8é€±ã€‚æ¯é€±10å…ƒï¼Œ8é€±å°±æ˜¯10Ã—8=80å…ƒï¼ğŸ’°" },
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-lime-100 border-lime-300", question: "ä»Šå¤©æ˜ŸæœŸå››ï¼Œ10å¤©å¾Œæ˜¯æ˜ŸæœŸå¹¾ï¼Ÿ", options: ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰"], correct: 0, type: "application", explanation: "ä¸€é€±7å¤©ï¼Œ10å¤©=1é€±+3å¤©ã€‚æ˜ŸæœŸå››+3å¤©=æ˜ŸæœŸæ—¥ï¼ğŸ“…" },
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-lime-100 border-lime-300", question: "è²·3æç­†èŠ±36å…ƒï¼Œæ¯æç­†å¤šå°‘éŒ¢ï¼Ÿ", options: ["10å…ƒ", "11å…ƒ", "12å…ƒ", "13å…ƒ"], correct: 2, type: "application", explanation: "36å…ƒå¹³å‡åˆ†çµ¦3æç­†ï¼š36 Ã· 3 = 12å…ƒ/æã€‚æª¢é©—ï¼š12Ã—3=36 âœ“ âœï¸" },
            
            // ä»£æ•¸ (3é¡Œ) - æ–°çš„æ¨¡å¼æ€è€ƒ
            { category: "ğŸ¨ ä»£æ•¸", color: "bg-violet-100 border-violet-300", question: "è¦å¾‹ï¼š2, 5, 8, 11, ?", options: ["13", "14", "15", "16"], correct: 1, type: "algebra", explanation: "æ¯æ¬¡éƒ½åŠ 3ï¼š2(+3)â†’5(+3)â†’8(+3)â†’11(+3)â†’14ï¼ğŸ”®" },
            { category: "ğŸ¨ ä»£æ•¸", color: "bg-violet-100 border-violet-300", question: "å¦‚æœâ˜†Ã—3=15ï¼Œé‚£éº¼â˜†Ã—5=?", options: ["20", "25", "30", "35"], correct: 1, type: "algebra", explanation: "â˜†Ã—3=15ï¼Œæ‰€ä»¥â˜†=5ã€‚é‚£éº¼â˜†Ã—5=5Ã—5=25ï¼â­" },
            { category: "ğŸ¨ ä»£æ•¸", color: "bg-violet-100 border-violet-300", question: "æ•¸å­—é‡‘å­—å¡”ï¼šæœ€ä¸Š1ï¼Œç¬¬äºŒå±¤2ã€3ï¼Œç¬¬ä¸‰å±¤ï¼Ÿ", options: ["4,5,6", "3,4,5", "5,6,7", "4,5"], correct: 0, type: "algebra", explanation: "è¦å¾‹æ˜¯é€£çºŒæ•¸å­—ï¼š1ï½œ2,3ï½œ4,5,6ï½œ7,8,9,10...æ¯å±¤å¤šä¸€å€‹æ•¸ï¼ğŸ”º" },
            
            // çµ„åˆ (3é¡Œ) - æ–°çš„é‚è¼¯æŒ‘æˆ°
            { category: "ğŸ§© çµ„åˆ", color: "bg-amber-100 border-amber-300", question: "5å€‹äººæ¡æ‰‹ï¼Œæ¯äººéƒ½è¦å’Œå…¶ä»–äººæ¡ä¸€æ¬¡ï¼Œå…±æ¡å¹¾æ¬¡ï¼Ÿ", options: ["8æ¬¡", "9æ¬¡", "10æ¬¡", "11æ¬¡"], correct: 2, type: "combination", explanation: "5äººé¸2äººæ¡æ‰‹ï¼š5Ã—4Ã·2=10æ¬¡ã€‚åƒé€£ç·šéŠæˆ²ï¼Œä¸é‡è¤‡ï¼ğŸ¤" },
            { category: "ğŸ§© çµ„åˆ", color: "bg-amber-100 border-amber-300", question: "æœ‰ç´…é»ƒè—3ä»¶è¡£æœã€é»‘ç™½2æ¢è¤²å­ï¼Œæœ‰å¹¾ç¨®ç©¿æ³•ï¼Ÿ", options: ["5ç¨®", "6ç¨®", "7ç¨®", "8ç¨®"], correct: 1, type: "combination", explanation: "æ¯ä»¶è¡£æœé…æ¯æ¢è¤²å­ï¼š3ä»¶è¡£æœÃ—2æ¢è¤²å­=6ç¨®çµ„åˆï¼ğŸ‘•" },
            { category: "ğŸ§© çµ„åˆ", color: "bg-amber-100 border-amber-300", question: "å°æ˜ã€å°è¯ã€å°ç¾è³½è·‘ï¼Œæ²’æœ‰ä¸¦åˆ—ï¼Œæœ‰å¹¾ç¨®åæ¬¡å¯èƒ½ï¼Ÿ", options: ["4ç¨®", "5ç¨®", "6ç¨®", "7ç¨®"], correct: 2, type: "combination", explanation: "ç¬¬ä¸€å3ç¨®é¸æ“‡ï¼Œç¬¬äºŒå2ç¨®ï¼Œç¬¬ä¸‰å1ç¨®ï¼š3Ã—2Ã—1=6ç¨®ï¼ğŸƒ" },
            
            // æ•¸æ„Ÿ (4é¡Œ) - æ–°çš„æ•¸å­—ç†è§£
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-rose-100 border-rose-300", question: "1å…¬å°º=100å…¬åˆ†ï¼ŒåŠå…¬å°ºæ˜¯å¹¾å…¬åˆ†ï¼Ÿ", options: ["25å…¬åˆ†", "50å…¬åˆ†", "75å…¬åˆ†", "100å…¬åˆ†"], correct: 1, type: "number_sense", explanation: "åŠå…¬å°ºå°±æ˜¯1å…¬å°ºçš„ä¸€åŠï¼š100Ã·2=50å…¬åˆ†ï¼ğŸ“" },
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-rose-100 border-rose-300", question: "å“ªå€‹åˆ†æ•¸æœ€å¤§ï¼Ÿ", options: ["1/2", "1/3", "1/4", "1/5"], correct: 0, type: "number_sense", explanation: "åˆ†æ¯è¶Šå°ï¼Œæ¯ä»½è¶Šå¤§ï¼æƒ³åƒåˆ‡è›‹ç³•ï¼šåˆ‡2ä»½æ¯”åˆ‡5ä»½ï¼Œæ¯ä»½æ›´å¤§ï¼ğŸ°" },
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-rose-100 border-rose-300", question: "299æœ€æ¥è¿‘å“ªå€‹æ•´ç™¾æ•¸ï¼Ÿ", options: ["100", "200", "300", "400"], correct: 2, type: "number_sense", explanation: "299é›¢300åªå·®1ï¼Œæ˜¯æœ€æ¥è¿‘çš„æ•´ç™¾æ•¸ï¼ğŸ¯" },
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-rose-100 border-rose-300", question: "ç”¨2ã€5ã€8å¯ä»¥çµ„æˆçš„æœ€å¤§ä¸‰ä½æ•¸æ˜¯ï¼Ÿ", options: ["258", "528", "825", "852"], correct: 3, type: "number_sense", explanation: "è¦æœ€å¤§ï¼Œç™¾ä½æ”¾æœ€å¤§çš„8ï¼Œåä½æ”¾æ¬¡å¤§çš„5ï¼Œå€‹ä½æ”¾2ï¼š852ï¼ğŸ’" }
        ];

        const appContainer = document.getElementById('app');

        // Function to handle user's answer
        function handleAnswer(selectedIndex) {
            answers[currentQuestionIndex] = selectedIndex;
            
            // æ›´æ–°é€£çºŒç­”å°æ¬¡æ•¸
            if (selectedIndex === questions[currentQuestionIndex].correct) {
                streakCount++;
            } else {
                streakCount = 0;
            }
            
            renderApp();

            if (currentQuestionIndex < questions.length - 1) {
                setTimeout(() => {
                    currentQuestionIndex++;
                    renderApp();
                }, 1600);
            } else {
                setTimeout(() => {
                    showResult = true;
                    renderApp();
                }, 1600);
            }
        }

        // Function to restart the quiz
        function restartQuiz() {
            currentQuestionIndex = 0;
            answers = {};
            showResult = false;
            startTime = Date.now();
            streakCount = 0;
            renderApp();
        }

        // Function to calculate final results
        function calculateResults() {
            const results = {
                calculation: { correct: 0, total: 0 },
                geometry: { correct: 0, total: 0 },
                application: { correct: 0, total: 0 },
                algebra: { correct: 0, total: 0 },
                combination: { correct: 0, total: 0 },
                number_sense: { correct: 0, total: 0 }
            };

            let maxStreak = 0;
            let currentStreak = 0;

            questions.forEach((question, index) => {
                const type = question.type;
                results[type].total++;
                if (answers[index] === question.correct) {
                    results[type].correct++;
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 0;
                }
            });

            results.maxStreak = maxStreak;
            return results;
        }

        // Main function to render the UI
        function renderApp() {
            // Set a space theme gradient background
            document.body.className = 'bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900';

            if (showResult) {
                renderResultScreen();
            } else {
                renderQuestionScreen();
            }
        }

        // Renders the question view
        function renderQuestionScreen() {
            const question = questions[currentQuestionIndex];
            const selectedAnswer = answers[currentQuestionIndex];
            const isAnswered = selectedAnswer !== undefined;

            const optionsHtml = question.options.map((option, index) => {
                let buttonClass = 'bg-white border-gray-300 text-gray-700 hover:shadow-lg cursor-pointer hover:bg-gray-50';
                let icon = '';

                if (isAnswered) {
                    if (index === question.correct) {
                        buttonClass = 'bg-green-200 border-green-400 text-green-800 shadow-lg';
                        icon = '<span class="inline-block ml-2">âœ…</span>';
                    } else if (index === selectedAnswer) {
                        buttonClass = 'bg-red-200 border-red-400 text-red-800';
                        icon = '<span class="inline-block ml-2">âŒ</span>';
                    } else {
                        buttonClass = 'bg-gray-100 border-gray-300 text-gray-500';
                    }
                }

                return `
                    <button
                        onclick="${isAnswered ? '' : `handleAnswer(${index})`}"
                        ${isAnswered ? 'disabled' : ''}
                        class="p-4 sm:p-5 rounded-2xl option-text font-bold border-4 transition-all duration-200 transform hover:scale-105 ${buttonClass}"
                    >
                        ${option} ${icon}
                    </button>
                `;
            }).join('');

            // é€£å‹æ•ˆæœ
            const streakDisplay = streakCount >= 3 ? `
                <div class="text-center mb-2">
                    <span class="inline-block bg-yellow-400 text-yellow-900 px-4 py-2 rounded-full font-bold animate-bounce">
                        ğŸ”¥ é€£çºŒç­”å° ${streakCount} é¡Œï¼
                    </span>
                </div>
            ` : '';

            appContainer.innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <!-- Theme Badge -->
                    <div class="text-center mb-4">
                        <span class="inline-block rainbow-bg text-white px-6 py-3 rounded-full font-bold text-xl shadow-lg">
                            ğŸš€ æ•¸å­¸æ¢ç´¢ä¹‹æ—… ğŸŒŸ
                        </span>
                    </div>

                    ${streakDisplay}

                    <!-- Progress Bar with stars -->
                    <div class="bg-white bg-opacity-20 rounded-full p-2 mb-6 relative">
                        <div 
                            class="bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-500 rounded-full h-4 transition-all duration-700"
                            style="width: ${((currentQuestionIndex + 1) / questions.length) * 100}%"
                        ></div>
                        ${Array(questions.length).fill().map((_, i) => `
                            <span class="absolute top-1/2 transform -translate-y-1/2 text-xs"
                                  style="left: ${(i + 0.5) / questions.length * 100}%">
                                ${i < currentQuestionIndex ? 'â­' : i === currentQuestionIndex ? 'ğŸŒŸ' : 'â˜†'}
                            </span>
                        `).join('')}
                    </div>

                    <div class="text-center text-white text-xl mb-4 font-semibold">
                        æ¢ç´¢ç«™ ${currentQuestionIndex + 1} / ${questions.length}
                    </div>

                    <!-- Question Card with floating effect -->
                    <div class="${question.color} rounded-3xl shadow-2xl p-6 sm:p-8 border-4 transform hover:scale-[1.02] transition-all duration-300">
                        <div class="text-center mb-6">
                            <div class="text-2xl sm:text-3xl font-bold text-gray-700 mb-4 flex items-center justify-center gap-2">
                                <span class="star-spin">${question.category.split(' ')[0]}</span>
                                <span>${question.category.split(' ')[1]}</span>
                            </div>
                            <div class="question-text font-bold text-gray-800 mb-6 min-h-[6rem] flex items-center justify-center">
                                ${question.question}
                            </div>
                        </div>

                        <!-- Answer Options Grid -->
                        <div class="grid grid-cols-2 gap-4">
                            ${optionsHtml}
                        </div>

                        ${isAnswered ? `
                            <div class="mt-6">
                                <div class="text-center text-3xl sm:text-4xl font-bold mb-2">
                                    ${selectedAnswer === question.correct ? 
                                        streakCount >= 3 ? "ğŸŠ å¤ªæ£’äº†ï¼ç¹¼çºŒä¿æŒï¼" : "ğŸ‰ ç­”å°äº†ï¼" 
                                        : "ğŸ’ª æ²’é—œä¿‚ï¼Œç¹¼çºŒåŠªåŠ›ï¼"}
                                </div>
                                ${question.explanation ? `
                                    <div class="bg-gradient-to-r from-white to-gray-50 bg-opacity-80 rounded-xl p-4 mt-4 border-2 border-gray-200">
                                        <div class="text-base font-bold text-gray-700 mb-1">ğŸ” è§£é¡Œç§˜è¨£ï¼š</div>
                                        <div class="text-base text-gray-700">${question.explanation}</div>
                                    </div>
                                ` : ''}
                                <div class="text-center text-lg text-gray-600 mt-2">
                                    ${currentQuestionIndex < questions.length - 1 ? 'æº–å‚™æ¢ç´¢ä¸‹ä¸€é¡Œ...' : 'çµ±è¨ˆæ¢ç´¢æˆæœä¸­...'}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        // Renders the result view
        function renderResultScreen() {
            const results = calculateResults();
            const totalCorrect = Object.values(results).reduce((sum, r) => sum + r.correct, 0);
            const totalQuestions = questions.length;
            const scorePercentage = totalCorrect / totalQuestions;
            const timeTaken = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            
            let resultEmoji = "ğŸŒŸ";
            let resultMessage = "æ¢ç´¢å®Œæˆï¼ä½ å­¸åˆ°äº†å¾ˆå¤šï¼";
            let starCount = 1;
            let achievementBadge = "";

            if (scorePercentage >= 0.95) {
                resultEmoji = "ğŸ‘‘";
                resultMessage = "ä½ æ˜¯æ•¸å­¸æ¢ç´¢å¤§å¸«ï¼";
                starCount = 5;
                achievementBadge = "ğŸ† å®Œç¾æ¢ç´¢è€…";
            } else if (scorePercentage >= 0.85) {
                resultEmoji = "ğŸ¯";
                resultMessage = "æ¢ç´¢æˆæœè±å¯Œï¼è¡¨ç¾å„ªç•°ï¼";
                starCount = 4;
                achievementBadge = "ğŸ¥‡ å„ªç§€æ¢ç´¢è€…";
            } else if (scorePercentage >= 0.7) {
                resultEmoji = "ğŸš€";
                resultMessage = "æ¢ç´¢é †åˆ©ï¼ç¹¼çºŒå‰é€²ï¼";
                starCount = 3;
                achievementBadge = "ğŸ¥ˆ ç†Ÿç·´æ¢ç´¢è€…";
            } else if (scorePercentage >= 0.5) {
                resultEmoji = "â­";
                resultMessage = "ä¸éŒ¯çš„é–‹å§‹ï¼å†æ¥å†å²ï¼";
                starCount = 2;
                achievementBadge = "ğŸ¥‰ æ–°æ‰‹æ¢ç´¢è€…";
            }

            // ç‰¹æ®Šæˆå°±
            const specialAchievements = [];
            if (results.maxStreak >= 5) specialAchievements.push("ğŸ”¥ é€£å‹é”äºº");
            if (timeTaken < 300) specialAchievements.push("âš¡ å¿«é€Ÿæ€è€ƒè€…");
            if (results.calculation.correct === results.calculation.total && results.calculation.total > 0) 
                specialAchievements.push("ğŸ§® è¨ˆç®—å°ˆå®¶");

            const categoryResultsHtml = Object.keys(results).filter(key => key !== 'maxStreak').map(key => {
                const categoryMap = {
                    calculation: { name: "ğŸ§® è¨ˆç®—", style: "bg-orange-50 border-orange-200 text-orange-600", color: "from-orange-400 to-red-400" },
                    geometry: { name: "ğŸ”º å¹¾ä½•", style: "bg-cyan-50 border-cyan-200 text-cyan-600", color: "from-cyan-400 to-blue-400" },
                    application: { name: "ğŸ›’ æ‡‰ç”¨", style: "bg-lime-50 border-lime-200 text-lime-600", color: "from-lime-400 to-green-400" },
                    algebra: { name: "ğŸ¨ ä»£æ•¸", style: "bg-violet-50 border-violet-200 text-violet-600", color: "from-violet-400 to-purple-400" },
                    combination: { name: "ğŸ§© çµ„åˆ", style: "bg-amber-50 border-amber-200 text-amber-600", color: "from-amber-400 to-yellow-400" },
                    number_sense: { name: "ğŸ”¢ æ•¸æ„Ÿ", style: "bg-rose-50 border-rose-200 text-rose-600", color: "from-rose-400 to-pink-400" },
                };
                const info = categoryMap[key];
                const percentage = results[key].total > 0 ? Math.round((results[key].correct / results[key].total) * 100) : 0;
                
                return `
                    <div class="${info.style} p-4 rounded-xl border-2 transform hover:scale-105 transition-all duration-200 hover:shadow-lg">
                        <div class="text-lg font-bold">${info.name}</div>
                        <div class="text-2xl font-bold">${results[key].correct}/${results[key].total}</div>
                        <div class="text-sm mb-2">æ­£ç¢ºç‡ ${percentage}%</div>
                        <div class="bg-gray-200 rounded-full h-3">
                            <div class="bg-gradient-to-r ${info.color} h-3 rounded-full transition-all duration-1000 relative overflow-hidden" 
                                 style="width: ${percentage}%">
                                <div class="absolute inset-0 bg-white opacity-30 animate-pulse"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            const starsHtml = Array(5).fill().map((_, i) => 
                `<span class="text-5xl ${i < starCount ? 'text-yellow-400' : 'text-gray-300'}">${i < starCount ? 'â­' : 'â˜†'}</span>`
            ).join('');

            appContainer.innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white rounded-3xl shadow-2xl p-8 text-center">
                        <div class="text-8xl mb-4 pulse">${resultEmoji}</div>
                        
                        ${achievementBadge ? `
                            <div class="inline-block bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-full font-bold text-xl mb-4 shadow-lg">
                                ${achievementBadge}
                            </div>
                        ` : ''}
                        
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">æ¢ç´¢å®Œæˆï¼</h2>
                        
                        <div class="flex justify-center gap-1 mb-6">
                            ${starsHtml}
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="bg-gradient-to-br from-blue-100 to-purple-100 rounded-xl p-4">
                                <div class="text-4xl mb-1">ğŸ¯</div>
                                <div class="text-sm text-gray-600">ç¸½åˆ†</div>
                                <div class="text-2xl font-bold text-purple-600">${totalCorrect}/${totalQuestions}</div>
                            </div>
                            <div class="bg-gradient-to-br from-green-100 to-teal-100 rounded-xl p-4">
                                <div class="text-4xl mb-1">ğŸ“Š</div>
                                <div class="text-sm text-gray-600">æ­£ç¢ºç‡</div>
                                <div class="text-2xl font-bold text-green-600">${Math.round(scorePercentage * 100)}%</div>
                            </div>
                            <div class="bg-gradient-to-br from-orange-100 to-yellow-100 rounded-xl p-4">
                                <div class="text-4xl mb-1">â±ï¸</div>
                                <div class="text-sm text-gray-600">ç”¨æ™‚</div>
                                <div class="text-2xl font-bold text-orange-600">${minutes}:${seconds.toString().padStart(2, '0')}</div>
                            </div>
                        </div>

                        ${results.maxStreak >= 3 ? `
                            <div class="bg-gradient-to-r from-yellow-100 to-orange-100 rounded-xl p-4 mb-6">
                                <div class="text-lg text-gray-600">æœ€é«˜é€£å‹</div>
                                <div class="text-3xl font-bold text-orange-600">ğŸ”¥ ${results.maxStreak} é¡Œ</div>
                            </div>
                        ` : ''}

                        ${specialAchievements.length > 0 ? `
                            <div class="mb-6">
                                <div class="text-lg font-bold text-gray-700 mb-2">ğŸ… ç‰¹æ®Šæˆå°±</div>
                                <div class="flex flex-wrap justify-center gap-2">
                                    ${specialAchievements.map(achievement => `
                                        <span class="inline-block bg-gradient-to-r from-purple-200 to-pink-200 px-4 py-2 rounded-full text-sm font-bold">
                                            ${achievement}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6">
                           ${categoryResultsHtml}
                        </div>

                        <div class="text-2xl mb-6 font-bold text-gray-700">
                            ${resultMessage}
                        </div>

                        <button
                            onclick="restartQuiz()"
                            class="rainbow-bg text-white text-xl font-bold py-4 px-8 rounded-2xl hover:shadow-lg transform hover:scale-105 transition-all duration-200"
                        >
                            å†æ¬¡æ¢ç´¢ ğŸš€
                        </button>
                    </div>
                </div>
            `;
        }

        // Initial render to start the quiz
        renderApp();

    </script>
</body>
</html>