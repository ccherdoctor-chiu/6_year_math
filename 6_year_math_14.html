<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ƒæ­²æ•¸å­¸é­”æ³•å­¸é™¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        /* Magic entrance animation */
        #app > div {
            animation: magicAppear 1s ease-out;
        }
        @keyframes magicAppear {
            0% { opacity: 0; transform: scale(0.8) rotate(-5deg); }
            50% { transform: scale(1.05) rotate(2deg); }
            100% { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        /* Wand sparkle animation */
        .wand-sparkle {
            animation: sparkle 2s ease-in-out infinite;
        }
        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1) rotate(0deg); }
            50% { opacity: 0.7; transform: scale(1.2) rotate(180deg); }
        }
        /* Magic glow effect */
        .magic-glow {
            animation: glow 3s ease-in-out infinite;
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(147, 51, 234, 0.5); }
            50% { box-shadow: 0 0 40px rgba(147, 51, 234, 0.8); }
        }
        /* Potion bubble animation */
        .bubble-float {
            animation: bubbleFloat 4s ease-in-out infinite;
        }
        @keyframes bubbleFloat {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-15px) translateX(5px); }
            75% { transform: translateY(-20px) translateX(-5px); }
        }
        /* Spell casting animation */
        .spell-cast {
            animation: castSpell 1.5s ease-out;
        }
        @keyframes castSpell {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(360deg); opacity: 0.5; }
            100% { transform: scale(1) rotate(720deg); opacity: 1; }
        }
        /* Magic stars floating */
        .star-float {
            animation: starFloat 6s linear infinite;
        }
        @keyframes starFloat {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        /* Question and option text sizes */
        .question-text {
            font-size: 1.75rem;
            line-height: 2.25rem;
        }
        .option-text {
            font-size: 1.5rem;
        }
        @media (min-width: 640px) {
            .question-text {
                font-size: 2rem;
                line-height: 2.5rem;
            }
            .option-text {
                font-size: 1.75rem;
            }
        }
        /* Magic background gradient */
        .magic-bg {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 25%, #4c1d95 50%, #6b21a8 75%, #86198f 100%);
            position: relative;
            overflow: hidden;
        }
        /* Floating stars background */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        .star {
            position: absolute;
            color: white;
            opacity: 0.6;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="stars-container" id="starsContainer"></div>
    
    <div id="app" class="min-h-screen p-4 relative z-10">
        <!-- The quiz will be rendered here by JavaScript -->
    </div>

    <script>
        // Create floating stars background
        function createStars() {
            const container = document.getElementById('starsContainer');
            const starSymbols = ['âœ¨', 'â­', 'âœ¦', 'âœ§', 'â˜†'];
            
            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.className = 'star star-float';
                star.style.left = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 6 + 's';
                star.style.fontSize = (Math.random() * 20 + 10) + 'px';
                star.textContent = starSymbols[Math.floor(Math.random() * starSymbols.length)];
                container.appendChild(star);
            }
        }
        createStars();

        // State variables
        let currentQuestionIndex = 0;
        let answers = {};
        let showResult = false;
        let startTime = Date.now();
        let magicPower = 0; // é­”æ³•èƒ½é‡
        let spellsLearned = []; // å­¸æœƒçš„å’’èª
        let potionsCreated = 0; // è£½ä½œçš„é­”è—¥æ•¸

        // Magic-themed questions
        const questions = [
            // è¨ˆç®— (4é¡Œ) - é­”æ³•ææ–™è¨ˆç®—
            { category: "ğŸ§® è¨ˆç®—", color: "bg-purple-100 border-purple-400", question: "é­”æ³•å•†åº—æœ‰26æ ¹é­”æ–ï¼Œåˆé€²è²¨17æ ¹ï¼Œç¾åœ¨æœ‰å¹¾æ ¹ï¼Ÿ", options: ["41", "42", "43", "44"], correct: 2, type: "calculation", spell: "æ•¸å­—é­”æ³•", power: 3 },
            { category: "ğŸ§® è¨ˆç®—", color: "bg-purple-100 border-purple-400", question: "å·«å¸«å¡”æœ‰72æœ¬é­”æ³•æ›¸ï¼Œå€Ÿå‡ºå»34æœ¬ï¼Œé‚„å‰©å¹¾æœ¬ï¼Ÿ", options: ["36", "37", "38", "39"], correct: 2, type: "calculation", spell: "æ¸›æ³•å’’èª", power: 3 },
            { category: "ğŸ§® è¨ˆç®—", color: "bg-purple-100 border-purple-400", question: "æ¯å€‹é­”æ³•é™£éœ€è¦8é¡†å¯¶çŸ³ï¼Œ3å€‹é­”æ³•é™£éœ€è¦å¹¾é¡†ï¼Ÿ", options: ["22", "23", "24", "25"], correct: 2, type: "calculation", spell: "å€æ•¸é­”æ³•", power: 3 },
            { category: "ğŸ§® è¨ˆç®—", color: "bg-purple-100 border-purple-400", question: "é­”è—¥éœ€è¦__ æ»´æœˆå…‰éœ²ï¼Œå·²æœ‰13æ»´ï¼Œå…±éœ€48æ»´ï¼Œé‚„å·®å¹¾æ»´ï¼Ÿ", options: ["33", "34", "35", "36"], correct: 2, type: "calculation", spell: "é­”è—¥è¨ˆç®—", power: 3 },
            
            // å¹¾ä½• (4é¡Œ) - é­”æ³•åœ–å½¢
            { category: "ğŸ”º å¹¾ä½•", color: "bg-indigo-100 border-indigo-400", question: "é­”æ³•é™£é€šå¸¸æ˜¯ä»€éº¼å½¢ç‹€ï¼Ÿï¼ˆæç¤ºï¼šåƒCDï¼‰", options: ["æ­£æ–¹å½¢", "åœ“å½¢", "ä¸‰è§’å½¢", "å…­é‚Šå½¢"], correct: 1, type: "geometry", spell: "åœ–å½¢è¾¨è­˜", power: 2 },
            { category: "ğŸ”º å¹¾ä½•", color: "bg-indigo-100 border-indigo-400", question: "é‡‘å­—å¡”é­”æ³•çŸ³æœ‰å¹¾å€‹ä¸‰è§’å½¢é¢ï¼Ÿ", options: ["3å€‹", "4å€‹", "5å€‹", "6å€‹"], correct: 1, type: "geometry", spell: "ç«‹é«”é­”æ³•", power: 2 },
            { category: "ğŸ”º å¹¾ä½•", color: "bg-indigo-100 border-indigo-400", question: "é­”é¡å¯ä»¥ç…§å‡ºç‰©é«”çš„ä»€éº¼åœ–åƒï¼Ÿ", options: ["æ”¾å¤§", "ç¸®å°", "é¡åƒ", "æ—‹è½‰"], correct: 2, type: "geometry", spell: "é¡åƒå’’èª", power: 2 },
            { category: "ğŸ”º å¹¾ä½•", color: "bg-indigo-100 border-indigo-400", question: "é­”æ³•æ£’æ®å‹•ç•«å‡ºçš„æ˜Ÿæ˜Ÿæœ‰å¹¾å€‹è§’ï¼Ÿ", options: ["4å€‹", "5å€‹", "6å€‹", "7å€‹"], correct: 1, type: "geometry", spell: "æ˜Ÿæ˜Ÿé­”æ³•", power: 2 },
            
            // æ‡‰ç”¨ (4é¡Œ) - é­”æ³•å­¸é™¢ç”Ÿæ´»
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-pink-100 border-pink-400", question: "é­”æ³•èª²9:00é–‹å§‹ï¼ŒæŒçºŒ2å°æ™‚ï¼Œå¹¾é»çµæŸï¼Ÿ", options: ["10:00", "11:00", "12:00", "13:00"], correct: 1, type: "application", spell: "æ™‚é–“é­”æ³•", power: 4 },
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-pink-100 border-pink-400", question: "4ä½å°å·«å¸«å¹³åˆ†32é¡†é­”æ³•ç³–ï¼Œæ¯äººå¾—å¹¾é¡†ï¼Ÿ", options: ["6é¡†", "7é¡†", "8é¡†", "9é¡†"], correct: 2, type: "application", spell: "åˆ†äº«å’’èª", power: 4 },
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-pink-100 border-pink-400", question: "é­”æ³•è—¥æ°´100æ¯«å‡ï¼Œå–äº†35æ¯«å‡ï¼Œé‚„å‰©å¤šå°‘ï¼Ÿ", options: ["55æ¯«å‡", "60æ¯«å‡", "65æ¯«å‡", "70æ¯«å‡"], correct: 2, type: "application", spell: "é­”è—¥æ¸¬é‡", power: 4 },
            { category: "ğŸ›’ æ‡‰ç”¨", color: "bg-pink-100 border-pink-400", question: "é£›å¤©æƒå¸šæ¯å°æ™‚é£›20å…¬é‡Œï¼Œ3å°æ™‚é£›å¤šé ï¼Ÿ", options: ["50å…¬é‡Œ", "55å…¬é‡Œ", "60å…¬é‡Œ", "65å…¬é‡Œ"], correct: 2, type: "application", spell: "é£›è¡Œé­”æ³•", power: 4 },
            
            // ä»£æ•¸ (3é¡Œ) - ç¥ç§˜é­”æ³•ç¬¦æ–‡
            { category: "ğŸ¨ ä»£æ•¸", color: "bg-amber-100 border-amber-400", question: "é­”æ³•ç¬¦æ–‡ï¼šâœ¦, âœ¦âœ¦âœ¦, âœ¦âœ¦âœ¦âœ¦âœ¦, ?", options: ["âœ¦âœ¦âœ¦âœ¦âœ¦âœ¦", "âœ¦âœ¦âœ¦âœ¦âœ¦âœ¦âœ¦", "âœ¦âœ¦âœ¦âœ¦", "âœ¦âœ¦"], correct: 1, type: "algebra", spell: "ç¬¦æ–‡è§£è®€", power: 5 },
            { category: "ğŸ¨ ä»£æ•¸", color: "bg-amber-100 border-amber-400", question: "å¦‚æœğŸŒ™ = 6ï¼Œé‚£éº¼ğŸŒ™ + ğŸŒ™ + ğŸŒ™ = ?", options: ["12", "15", "18", "21"], correct: 2, type: "algebra", spell: "æœˆäº®é­”æ³•", power: 5 },
            { category: "ğŸ¨ ä»£æ•¸", color: "bg-amber-100 border-amber-400", question: "é­”æ³•æ•¸åˆ—ï¼š5, 10, 15, 20, ?", options: ["22", "25", "28", "30"], correct: 1, type: "algebra", spell: "æ•¸åˆ—å’’èª", power: 5 },
            
            // çµ„åˆ (3é¡Œ) - é­”æ³•é…æ–¹
            { category: "ğŸ§© çµ„åˆ", color: "bg-emerald-100 border-emerald-400", question: "æœ‰4ç¨®é­”æ³•å…ƒç´ ï¼Œé¸2ç¨®èª¿é…ï¼Œæœ‰å¹¾ç¨®çµ„åˆï¼Ÿ", options: ["4ç¨®", "5ç¨®", "6ç¨®", "8ç¨®"], correct: 2, type: "combination", spell: "å…ƒç´ çµ„åˆ", power: 3 },
            { category: "ğŸ§© çµ„åˆ", color: "bg-emerald-100 border-emerald-400", question: "3ä»¶é­”æ³•è¢é…2é ‚å·«å¸«å¸½ï¼Œæœ‰å¹¾ç¨®ç©¿æ­ï¼Ÿ", options: ["5ç¨®", "6ç¨®", "7ç¨®", "8ç¨®"], correct: 1, type: "combination", spell: "è®Šè£é­”æ³•", power: 3 },
            { category: "ğŸ§© çµ„åˆ", color: "bg-emerald-100 border-emerald-400", question: "é­”æ³•æ¯”è³½3äººåƒåŠ ï¼Œå† äºè»æœ‰å¹¾ç¨®å¯èƒ½ï¼Ÿ", options: ["3ç¨®", "4ç¨®", "5ç¨®", "6ç¨®"], correct: 3, type: "combination", spell: "ç«¶è³½é è¨€", power: 3 },
            
            // æ•¸æ„Ÿ (4é¡Œ) - é­”æ³•æ•¸å­—æ„ŸçŸ¥
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-teal-100 border-teal-400", question: "æœ€å¼·å¤§çš„é­”æ³•å€¼999ï¼Œæœ€æ¥è¿‘å¤šå°‘ï¼Ÿ", options: ["900", "950", "1000", "1050"], correct: 2, type: "number_sense", spell: "æ•¸å€¼æ„Ÿæ‡‰", power: 2 },
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-teal-100 border-teal-400", question: "é­”è—¥é…æ–¹ï¼š2/3æ¯é¾è¡€ï¼Œæ¯”1/2æ¯å¤šé‚„æ˜¯å°‘ï¼Ÿ", options: ["å¤š", "å°‘", "ä¸€æ¨£", "ç„¡æ³•æ¯”è¼ƒ"], correct: 0, type: "number_sense", spell: "åˆ†æ•¸é­”æ³•", power: 2 },
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-teal-100 border-teal-400", question: "ç”¨æ•¸å­—3ã€7ã€2æ’å‡ºæœ€å¤§çš„é­”æ³•æ•¸å­—ï¼Ÿ", options: ["237", "327", "723", "732"], correct: 3, type: "number_sense", spell: "æ•¸å­—æ’åˆ—", power: 2 },
            { category: "ğŸ”¢ æ•¸æ„Ÿ", color: "bg-teal-100 border-teal-400", question: "å·«å¸«å¡”é«˜49.8å…¬å°ºï¼Œç´„ç­‰æ–¼å¹¾å…¬å°ºï¼Ÿ", options: ["40å…¬å°º", "45å…¬å°º", "50å…¬å°º", "55å…¬å°º"], correct: 2, type: "number_sense", spell: "ä¼°ç®—é­”æ³•", power: 2 }
        ];

        const appContainer = document.getElementById('app');

        // Handle answer selection
        function handleAnswer(selectedIndex) {
            answers[currentQuestionIndex] = selectedIndex;
            
            // ç­”å°ç²å¾—é­”æ³•èƒ½é‡å’Œå­¸ç¿’å’’èª
            if (selectedIndex === questions[currentQuestionIndex].correct) {
                magicPower += questions[currentQuestionIndex].power || 1;
                if (!spellsLearned.includes(questions[currentQuestionIndex].spell)) {
                    spellsLearned.push(questions[currentQuestionIndex].spell);
                }
                // ç‰¹æ®Šæˆå°±ï¼šè£½ä½œé­”è—¥
                if (questions[currentQuestionIndex].type === 'application' || questions[currentQuestionIndex].type === 'algebra') {
                    potionsCreated++;
                }
            }
            
            renderApp();

            if (currentQuestionIndex < questions.length - 1) {
                setTimeout(() => {
                    currentQuestionIndex++;
                    renderApp();
                }, 1600);
            } else {
                setTimeout(() => {
                    showResult = true;
                    renderApp();
                }, 1600);
            }
        }

        // Restart quiz
        function restartQuiz() {
            currentQuestionIndex = 0;
            answers = {};
            showResult = false;
            startTime = Date.now();
            magicPower = 0;
            spellsLearned = [];
            potionsCreated = 0;
            renderApp();
        }

        // Calculate results
        function calculateResults() {
            const results = {
                calculation: { correct: 0, total: 0 },
                geometry: { correct: 0, total: 0 },
                application: { correct: 0, total: 0 },
                algebra: { correct: 0, total: 0 },
                combination: { correct: 0, total: 0 },
                number_sense: { correct: 0, total: 0 }
            };

            questions.forEach((question, index) => {
                const type = question.type;
                results[type].total++;
                if (answers[index] === question.correct) {
                    results[type].correct++;
                }
            });

            return results;
        }

        // Main render function
        function renderApp() {
            // Magic theme gradient background
            document.body.className = 'magic-bg';

            if (showResult) {
                renderResultScreen();
            } else {
                renderQuestionScreen();
            }
        }

        // Render question screen
        function renderQuestionScreen() {
            const question = questions[currentQuestionIndex];
            const selectedAnswer = answers[currentQuestionIndex];
            const isAnswered = selectedAnswer !== undefined;

            const optionsHtml = question.options.map((option, index) => {
                let buttonClass = 'bg-white bg-opacity-90 border-purple-300 text-purple-800 hover:shadow-xl cursor-pointer hover:bg-opacity-100 magic-glow';
                let icon = '';

                if (isAnswered) {
                    if (index === question.correct) {
                        buttonClass = 'bg-green-200 border-green-500 text-green-800 shadow-xl spell-cast';
                        icon = '<span class="inline-block ml-2">âœ¨</span>';
                    } else if (index === selectedAnswer) {
                        buttonClass = 'bg-red-200 border-red-500 text-red-800';
                        icon = '<span class="inline-block ml-2">ğŸ’«</span>';
                    } else {
                        buttonClass = 'bg-gray-100 border-gray-300 text-gray-500 opacity-60';
                    }
                }

                return `
                    <button
                        onclick="${isAnswered ? '' : `handleAnswer(${index})`}"
                        ${isAnswered ? 'disabled' : ''}
                        class="p-4 sm:p-5 rounded-2xl option-text font-bold border-3 transition-all duration-300 transform hover:scale-105 ${buttonClass}"
                    >
                        ${option} ${icon}
                    </button>
                `;
            }).join('');

            // é­”æ³•é€²åº¦æ¢
            const magicProgress = ((currentQuestionIndex + 1) / questions.length) * 100;

            appContainer.innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <!-- Magic Academy Header -->
                    <div class="text-center mb-4">
                        <div class="inline-block bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-full font-bold text-xl shadow-lg magic-glow">
                            <span class="wand-sparkle inline-block">ğŸª„</span> æ•¸å­¸é­”æ³•å­¸é™¢ <span class="wand-sparkle inline-block">ğŸŒŸ</span>
                        </div>
                    </div>

                    <!-- Magic Power Display -->
                    <div class="text-center mb-4 flex justify-center gap-4">
                        <span class="inline-block bg-purple-200 text-purple-800 px-4 py-2 rounded-full font-bold">
                            âš¡ é­”æ³•èƒ½é‡ï¼š${magicPower}
                        </span>
                        <span class="inline-block bg-pink-200 text-pink-800 px-4 py-2 rounded-full font-bold">
                            ğŸ“œ å’’èªï¼š${spellsLearned.length}
                        </span>
                    </div>

                    <!-- Magic Progress Bar -->
                    <div class="relative mb-6">
                        <div class="bg-white bg-opacity-20 rounded-full p-2">
                            <div class="bg-gradient-to-r from-purple-400 via-pink-400 to-purple-400 rounded-full h-4 transition-all duration-700 relative overflow-hidden"
                                 style="width: ${magicProgress}%">
                                <div class="absolute inset-0 bg-white opacity-30 animate-pulse"></div>
                            </div>
                        </div>
                        <div class="absolute -top-2 transition-all duration-700" style="left: ${Math.max(2, magicProgress - 2)}%">
                            <span class="text-3xl wand-sparkle">ğŸª„</span>
                        </div>
                    </div>

                    <div class="text-center text-white drop-shadow-lg text-xl mb-4 font-bold">
                        ğŸ“ ç¬¬ ${currentQuestionIndex + 1} èª² / å…± ${questions.length} èª²
                    </div>

                    <!-- Question Card -->
                    <div class="${question.color} rounded-3xl shadow-2xl p-6 sm:p-8 border-4 transform hover:rotate-1 transition-all duration-300 relative overflow-hidden">
                        <div class="absolute top-2 right-2 bubble-float text-4xl opacity-30">ğŸ«§</div>
                        
                        <div class="text-center mb-6">
                            <div class="text-2xl sm:text-3xl font-bold text-gray-700 mb-4 flex items-center justify-center gap-2">
                                <span>${question.category}</span>
                            </div>
                            <div class="question-text font-bold text-gray-800 mb-6 min-h-[6rem] flex items-center justify-center">
                                ${question.question}
                            </div>
                        </div>

                        <!-- Answer Options -->
                        <div class="grid grid-cols-2 gap-4">
                            ${optionsHtml}
                        </div>

                        ${isAnswered ? `
                            <div class="mt-6">
                                <div class="text-center text-3xl sm:text-4xl font-bold mb-2">
                                    ${selectedAnswer === question.correct ? 
                                        `âœ¨ å’’èªæˆåŠŸï¼å­¸æœƒã€Œ${question.spell}ã€` 
                                        : "ğŸŒ™ å†è©¦ä¸€æ¬¡é­”æ³•ï¼"}
                                </div>
                                ${selectedAnswer === question.correct ? `
                                    <div class="text-center text-xl text-purple-600 font-bold">
                                        +${question.power} é­”æ³•èƒ½é‡ âš¡
                                    </div>
                                ` : ''}
                                <div class="text-center text-lg text-gray-600 mt-2 font-semibold">
                                    ${currentQuestionIndex < questions.length - 1 ? 'æº–å‚™ä¸‹ä¸€å ‚é­”æ³•èª²...' : 'å®Œæˆæ‰€æœ‰èª²ç¨‹ï¼Œçµ±è¨ˆé­”æ³•æˆå°±...'}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        // Render result screen
        function renderResultScreen() {
            const results = calculateResults();
            const totalCorrect = Object.values(results).reduce((sum, r) => sum + r.correct, 0);
            const totalQuestions = questions.length;
            const scorePercentage = totalCorrect / totalQuestions;
            const timeTaken = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            
            let resultEmoji = "ğŸ”®";
            let resultMessage = "å®Œæˆé­”æ³•è¨“ç·´ï¼";
            let wizardTitle = "é­”æ³•å­¸å¾’";

            if (scorePercentage >= 0.95) {
                resultEmoji = "ğŸ§™â€â™‚ï¸";
                resultMessage = "ä½ æˆç‚ºäº†å‰å¤§çš„é­”æ³•å¸«ï¼";
                wizardTitle = "å¤§é­”æ³•å¸«";
            } else if (scorePercentage >= 0.85) {
                resultEmoji = "ğŸ©";
                resultMessage = "å„ªç§€çš„é­”æ³•è¡¨ç¾ï¼";
                wizardTitle = "é«˜ç´šå·«å¸«";
            } else if (scorePercentage >= 0.7) {
                resultEmoji = "ğŸª„";
                resultMessage = "é­”æ³•æŠ€èƒ½æå‡ä¸­ï¼";
                wizardTitle = "è¦‹ç¿’å·«å¸«";
            } else if (scorePercentage >= 0.5) {
                resultEmoji = "ğŸ“š";
                resultMessage = "ç¹¼çºŒå­¸ç¿’é­”æ³•å§ï¼";
                wizardTitle = "é­”æ³•æ–°æ‰‹";
            }

            // ç‰¹æ®Šæˆå°±
            const achievements = [];
            if (magicPower >= 70) achievements.push("âš¡ é­”åŠ›å……æ²›");
            if (spellsLearned.length >= 15) achievements.push("ğŸ“œ å’’èªå¤§å¸«");
            if (potionsCreated >= 5) achievements.push("ğŸ§ª é­”è—¥å°ˆå®¶");
            if (scorePercentage === 1) achievements.push("âœ¨ å®Œç¾é­”æ³•å¸«");
            if (timeTaken < 420) achievements.push("â±ï¸ å¿«é€Ÿæ–½æ³•è€…");

            const categoryResultsHtml = Object.keys(results).map(key => {
                const categoryMap = {
                    calculation: { name: "ğŸ§® è¨ˆç®—", icon: "ğŸ”¢", style: "bg-purple-50 border-purple-300 text-purple-700", gradient: "from-purple-400 to-pink-400" },
                    geometry: { name: "ğŸ”º å¹¾ä½•", icon: "ğŸ“", style: "bg-indigo-50 border-indigo-300 text-indigo-700", gradient: "from-indigo-400 to-blue-400" },
                    application: { name: "ğŸ›’ æ‡‰ç”¨", icon: "ğŸ§ª", style: "bg-pink-50 border-pink-300 text-pink-700", gradient: "from-pink-400 to-rose-400" },
                    algebra: { name: "ğŸ¨ ä»£æ•¸", icon: "âœ¦", style: "bg-amber-50 border-amber-300 text-amber-700", gradient: "from-amber-400 to-yellow-400" },
                    combination: { name: "ğŸ§© çµ„åˆ", icon: "ğŸ²", style: "bg-emerald-50 border-emerald-300 text-emerald-700", gradient: "from-emerald-400 to-green-400" },
                    number_sense: { name: "ğŸ”¢ æ•¸æ„Ÿ", icon: "ğŸ”®", style: "bg-teal-50 border-teal-300 text-teal-700", gradient: "from-teal-400 to-cyan-400" },
                };
                const info = categoryMap[key];
                const percentage = results[key].total > 0 ? Math.round((results[key].correct / results[key].total) * 100) : 0;
                const mastery = percentage === 100 ? "ç²¾é€š" : percentage >= 75 ? "ç†Ÿç·´" : percentage >= 50 ? "å­¸ç¿’ä¸­" : "åˆå­¸";
                
                return `
                    <div class="${info.style} p-4 rounded-2xl border-2 transform hover:scale-105 transition-all duration-200 relative overflow-hidden hover:shadow-lg">
                        <div class="absolute top-1 right-1 text-2xl">${info.icon}</div>
                        <div class="text-lg font-bold">${info.name}</div>
                        <div class="text-2xl font-bold mt-1">${results[key].correct}/${results[key].total}</div>
                        <div class="text-sm">æŒæ¡åº¦ï¼š${mastery}</div>
                        <div class="mt-2 bg-gray-200 rounded-full h-3">
                            <div class="bg-gradient-to-r ${info.gradient} h-3 rounded-full transition-all duration-1000" 
                                 style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');

            appContainer.innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white bg-opacity-95 rounded-3xl shadow-2xl p-8 text-center border-4 border-purple-400 magic-glow">
                        <div class="text-8xl mb-4">${resultEmoji}</div>
                        
                        <h2 class="text-4xl font-bold text-gray-800 mb-2">é­”æ³•è¨“ç·´å®Œæˆï¼</h2>
                        
                        <div class="inline-block bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-full font-bold text-xl mb-6 shadow-lg">
                            ğŸ“ ${wizardTitle} ğŸ“
                        </div>
                        
                        <!-- ä¸»è¦æˆç¸¾ -->
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="bg-gradient-to-br from-purple-100 to-pink-100 rounded-2xl p-4">
                                <div class="text-3xl mb-1">ğŸ“œ</div>
                                <div class="text-sm text-gray-600">æ­£ç¢ºæ–½æ³•</div>
                                <div class="text-2xl font-bold text-purple-700">${totalCorrect}/${totalQuestions}</div>
                            </div>
                            <div class="bg-gradient-to-br from-blue-100 to-indigo-100 rounded-2xl p-4">
                                <div class="text-3xl mb-1">âš¡</div>
                                <div class="text-sm text-gray-600">é­”æ³•èƒ½é‡</div>
                                <div class="text-2xl font-bold text-indigo-700">${magicPower}é»</div>
                            </div>
                            <div class="bg-gradient-to-br from-amber-100 to-orange-100 rounded-2xl p-4">
                                <div class="text-3xl mb-1">â³</div>
                                <div class="text-sm text-gray-600">æ–½æ³•æ™‚é–“</div>
                                <div class="text-2xl font-bold text-orange-700">${minutes}:${seconds.toString().padStart(2, '0')}</div>
                            </div>
                        </div>

                        <!-- é­”æ³•æ›¸æ”¶é›† -->
                        <div class="mb-6 p-4 bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl">
                            <div class="text-lg font-bold text-gray-700 mb-3">ğŸ“š å­¸æœƒçš„å’’èªï¼ˆ${spellsLearned.length}å€‹ï¼‰</div>
                            <div class="flex flex-wrap justify-center gap-2">
                                ${spellsLearned.map(spell => `
                                    <span class="inline-block bg-white px-3 py-1 rounded-full text-sm font-bold shadow-md">
                                        âœ¨ ${spell}
                                    </span>
                                `).join('')}
                            </div>
                        </div>

                        <!-- æˆå°±å¾½ç«  -->
                        ${achievements.length > 0 ? `
                            <div class="mb-6">
                                <div class="text-lg font-bold text-gray-700 mb-3">ğŸ† é­”æ³•æˆå°±</div>
                                <div class="flex flex-wrap justify-center gap-3">
                                    ${achievements.map(achievement => `
                                        <span class="inline-block bg-gradient-to-r from-yellow-200 to-orange-200 px-4 py-2 rounded-full text-sm font-bold shadow-md">
                                            ${achievement}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <!-- å„ç§‘ç›®è¡¨ç¾ -->
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6">
                           ${categoryResultsHtml}
                        </div>

                        <div class="text-2xl mb-6 font-bold text-gray-700">
                            ${resultMessage}
                        </div>

                        <button
                            onclick="restartQuiz()"
                            class="bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:shadow-lg transform hover:scale-105 transition-all duration-200 magic-glow"
                        >
                            å†æ¬¡æ–½å±•é­”æ³• ğŸª„
                        </button>
                    </div>
                </div>
            `;
        }

        // Start the quiz
        renderApp();

    </script>
</body>
</html>