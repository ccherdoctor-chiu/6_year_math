<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏ÉÊ≠≤Êï∏Â≠∏È≠îÊ≥ïÂ≠∏Èô¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        /* Magic entrance animation */
        #app > div {
            animation: magicAppear 1s ease-out;
        }
        @keyframes magicAppear {
            0% { opacity: 0; transform: scale(0.8) rotate(-5deg); }
            50% { transform: scale(1.05) rotate(2deg); }
            100% { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        /* Wand sparkle animation */
        .wand-sparkle {
            animation: sparkle 2s ease-in-out infinite;
        }
        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1) rotate(0deg); }
            50% { opacity: 0.7; transform: scale(1.2) rotate(180deg); }
        }
        /* Magic glow effect */
        .magic-glow {
            animation: glow 3s ease-in-out infinite;
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(147, 51, 234, 0.5); }
            50% { box-shadow: 0 0 40px rgba(147, 51, 234, 0.8); }
        }
        /* Potion bubble animation */
        .bubble-float {
            animation: bubbleFloat 4s ease-in-out infinite;
        }
        @keyframes bubbleFloat {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-15px) translateX(5px); }
            75% { transform: translateY(-20px) translateX(-5px); }
        }
        /* Spell casting animation */
        .spell-cast {
            animation: castSpell 1.5s ease-out;
        }
        @keyframes castSpell {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(360deg); opacity: 0.5; }
            100% { transform: scale(1) rotate(720deg); opacity: 1; }
        }
        /* Magic stars floating */
        .star-float {
            animation: starFloat 6s linear infinite;
        }
        @keyframes starFloat {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        /* Question and option text sizes */
        .question-text {
            font-size: 1.75rem;
            line-height: 2.25rem;
        }
        .option-text {
            font-size: 1.5rem;
        }
        @media (min-width: 640px) {
            .question-text {
                font-size: 2rem;
                line-height: 2.5rem;
            }
            .option-text {
                font-size: 1.75rem;
            }
        }
        /* Magic background gradient */
        .magic-bg {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 25%, #4c1d95 50%, #6b21a8 75%, #86198f 100%);
            position: relative;
            overflow: hidden;
        }
        /* Floating stars background */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        .star {
            position: absolute;
            color: white;
            opacity: 0.6;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="stars-container" id="starsContainer"></div>
    
    <div id="app" class="min-h-screen p-4 relative z-10">
        <!-- The quiz will be rendered here by JavaScript -->
    </div>

    <script>
        // Create floating stars background
        function createStars() {
            const container = document.getElementById('starsContainer');
            const starSymbols = ['‚ú®', '‚≠ê', '‚ú¶', '‚úß', '‚òÜ'];
            
            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.className = 'star star-float';
                star.style.left = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 6 + 's';
                star.style.fontSize = (Math.random() * 20 + 10) + 'px';
                star.textContent = starSymbols[Math.floor(Math.random() * starSymbols.length)];
                container.appendChild(star);
            }
        }
        createStars();

        // State variables
        let currentQuestionIndex = 0;
        let answers = {};
        let showResult = false;
        let startTime = Date.now();
        let magicPower = 0; // È≠îÊ≥ïËÉΩÈáè
        let spellsLearned = []; // Â≠∏ÊúÉÁöÑÂííË™û
        let potionsCreated = 0; // Ë£Ω‰ΩúÁöÑÈ≠îËó•Êï∏

        // Magic-themed questions
        const questions = [
            // Ë®àÁÆó (4È°å) - È≠îÊ≥ïÊùêÊñôË®àÁÆó
            { category: "üßÆ Ë®àÁÆó", color: "bg-purple-100 border-purple-400", question: "È≠îÊ≥ïÂïÜÂ∫óÊúâ26Ê†πÈ≠îÊùñÔºåÂèàÈÄ≤Ë≤®17Ê†πÔºåÁèæÂú®ÊúâÂπæÊ†πÔºü", options: ["41", "42", "43", "44"], correct: 2, type: "calculation", spell: "Êï∏Â≠óÈ≠îÊ≥ï", power: 3 },
            { category: "üßÆ Ë®àÁÆó", color: "bg-purple-100 border-purple-400", question: "Â∑´Â∏´Â°îÊúâ72Êú¨È≠îÊ≥ïÊõ∏ÔºåÂÄüÂá∫Âéª34Êú¨ÔºåÈÇÑÂâ©ÂπæÊú¨Ôºü", options: ["36", "37", "38", "39"], correct: 2, type: "calculation", spell: "Ê∏õÊ≥ïÂííË™û", power: 3 },
            { category: "üßÆ Ë®àÁÆó", color: "bg-purple-100 border-purple-400", question: "ÊØèÂÄãÈ≠îÊ≥ïÈô£ÈúÄË¶Å8È°ÜÂØ∂Áü≥Ôºå3ÂÄãÈ≠îÊ≥ïÈô£ÈúÄË¶ÅÂπæÈ°ÜÔºü", options: ["22", "23", "24", "25"], correct: 2, type: "calculation", spell: "ÂÄçÊï∏È≠îÊ≥ï", power: 3 },
            { category: "üßÆ Ë®àÁÆó", color: "bg-purple-100 border-purple-400", question: "È≠îËó•ÈúÄË¶Å__ Êª¥ÊúàÂÖâÈú≤ÔºåÂ∑≤Êúâ13Êª¥ÔºåÂÖ±ÈúÄ48Êª¥ÔºåÈÇÑÂ∑ÆÂπæÊª¥Ôºü", options: ["33", "34", "35", "36"], correct: 2, type: "calculation", spell: "È≠îËó•Ë®àÁÆó", power: 3 },
            
            // Âπæ‰Ωï (4È°å) - È≠îÊ≥ïÂúñÂΩ¢
            { category: "üî∫ Âπæ‰Ωï", color: "bg-indigo-100 border-indigo-400", question: "È≠îÊ≥ïÈô£ÈÄöÂ∏∏ÊòØ‰ªÄÈ∫ºÂΩ¢ÁãÄÔºüÔºàÊèêÁ§∫ÔºöÂÉèCDÔºâ", options: ["Ê≠£ÊñπÂΩ¢", "ÂúìÂΩ¢", "‰∏âËßíÂΩ¢", "ÂÖ≠ÈÇäÂΩ¢"], correct: 1, type: "geometry", spell: "ÂúñÂΩ¢Ëæ®Ë≠ò", power: 2 },
            { category: "üî∫ Âπæ‰Ωï", color: "bg-indigo-100 border-indigo-400", question: "ÈáëÂ≠óÂ°îÈ≠îÊ≥ïÁü≥ÊúâÂπæÂÄã‰∏âËßíÂΩ¢Èù¢Ôºü", options: ["3ÂÄã", "4ÂÄã", "5ÂÄã", "6ÂÄã"], correct: 1, type: "geometry", spell: "Á´ãÈ´îÈ≠îÊ≥ï", power: 2 },
            { category: "üî∫ Âπæ‰Ωï", color: "bg-indigo-100 border-indigo-400", question: "È≠îÈè°ÂèØ‰ª•ÁÖßÂá∫Áâ©È´îÁöÑ‰ªÄÈ∫ºÂúñÂÉèÔºü", options: ["ÊîæÂ§ß", "Á∏ÆÂ∞è", "Èè°ÂÉè", "ÊóãËΩâ"], correct: 2, type: "geometry", spell: "Èè°ÂÉèÂííË™û", power: 2 },
            { category: "üî∫ Âπæ‰Ωï", color: "bg-indigo-100 border-indigo-400", question: "È≠îÊ≥ïÊ£íÊèÆÂãïÁï´Âá∫ÁöÑÊòüÊòüÊúâÂπæÂÄãËßíÔºü", options: ["4ÂÄã", "5ÂÄã", "6ÂÄã", "7ÂÄã"], correct: 1, type: "geometry", spell: "ÊòüÊòüÈ≠îÊ≥ï", power: 2 },
            
            // ÊáâÁî® (4È°å) - È≠îÊ≥ïÂ≠∏Èô¢ÁîüÊ¥ª
            { category: "üõí ÊáâÁî®", color: "bg-pink-100 border-pink-400", question: "È≠îÊ≥ïË™≤9:00ÈñãÂßãÔºåÊåÅÁ∫å2Â∞èÊôÇÔºåÂπæÈªûÁµêÊùüÔºü", options: ["10:00", "11:00", "12:00", "13:00"], correct: 1, type: "application", spell: "ÊôÇÈñìÈ≠îÊ≥ï", power: 4 },
            { category: "üõí ÊáâÁî®", color: "bg-pink-100 border-pink-400", question: "4‰ΩçÂ∞èÂ∑´Â∏´Âπ≥ÂàÜ32È°ÜÈ≠îÊ≥ïÁ≥ñÔºåÊØè‰∫∫ÂæóÂπæÈ°ÜÔºü", options: ["6È°Ü", "7È°Ü", "8È°Ü", "9È°Ü"], correct: 2, type: "application", spell: "ÂàÜ‰∫´ÂííË™û", power: 4 },
            { category: "üõí ÊáâÁî®", color: "bg-pink-100 border-pink-400", question: "È≠îÊ≥ïËó•Ê∞¥100ÊØ´ÂçáÔºåÂñù‰∫Ü35ÊØ´ÂçáÔºåÈÇÑÂâ©Â§öÂ∞ëÔºü", options: ["55ÊØ´Âçá", "60ÊØ´Âçá", "65ÊØ´Âçá", "70ÊØ´Âçá"], correct: 2, type: "application", spell: "È≠îËó•Ê∏¨Èáè", power: 4 },
            { category: "üõí ÊáâÁî®", color: "bg-pink-100 border-pink-400", question: "È£õÂ§©ÊéÉÂ∏öÊØèÂ∞èÊôÇÈ£õ20ÂÖ¨ÈáåÔºå3Â∞èÊôÇÈ£õÂ§öÈÅ†Ôºü", options: ["50ÂÖ¨Èáå", "55ÂÖ¨Èáå", "60ÂÖ¨Èáå", "65ÂÖ¨Èáå"], correct: 2, type: "application", spell: "È£õË°åÈ≠îÊ≥ï", power: 4 },
            
            // ‰ª£Êï∏ (3È°å) - Á•ûÁßòÈ≠îÊ≥ïÁ¨¶Êñá
            { category: "üé® ‰ª£Êï∏", color: "bg-amber-100 border-amber-400", question: "È≠îÊ≥ïÁ¨¶ÊñáÔºö‚ú¶, ‚ú¶‚ú¶‚ú¶, ‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶, ?", options: ["‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶", "‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶‚ú¶", "‚ú¶‚ú¶‚ú¶‚ú¶", "‚ú¶‚ú¶"], correct: 1, type: "algebra", spell: "Á¨¶ÊñáËß£ËÆÄ", power: 5 },
            { category: "üé® ‰ª£Êï∏", color: "bg-amber-100 border-amber-400", question: "Â¶ÇÊûúüåô = 6ÔºåÈÇ£È∫ºüåô + üåô + üåô = ?", options: ["12", "15", "18", "21"], correct: 2, type: "algebra", spell: "Êúà‰∫ÆÈ≠îÊ≥ï", power: 5 },
            { category: "üé® ‰ª£Êï∏", color: "bg-amber-100 border-amber-400", question: "È≠îÊ≥ïÊï∏ÂàóÔºö5, 10, 15, 20, ?", options: ["22", "25", "28", "30"], correct: 1, type: "algebra", spell: "Êï∏ÂàóÂííË™û", power: 5 },
            
            // ÁµÑÂêà (3È°å) - È≠îÊ≥ïÈÖçÊñπ
            { category: "üß© ÁµÑÂêà", color: "bg-emerald-100 border-emerald-400", question: "Êúâ4Á®ÆÈ≠îÊ≥ïÂÖÉÁ¥†ÔºåÈÅ∏2Á®ÆË™øÈÖçÔºåÊúâÂπæÁ®ÆÁµÑÂêàÔºü", options: ["4Á®Æ", "5Á®Æ", "6Á®Æ", "8Á®Æ"], correct: 2, type: "combination", spell: "ÂÖÉÁ¥†ÁµÑÂêà", power: 3 },
            { category: "üß© ÁµÑÂêà", color: "bg-emerald-100 border-emerald-400", question: "3‰ª∂È≠îÊ≥ïË¢çÈÖç2È†ÇÂ∑´Â∏´Â∏ΩÔºåÊúâÂπæÁ®ÆÁ©øÊê≠Ôºü", options: ["5Á®Æ", "6Á®Æ", "7Á®Æ", "8Á®Æ"], correct: 1, type: "combination", spell: "ËÆäË£ùÈ≠îÊ≥ï", power: 3 },
            { category: "üß© ÁµÑÂêà", color: "bg-emerald-100 border-emerald-400", question: "È≠îÊ≥ïÊØîË≥Ω3‰∫∫ÂèÉÂä†ÔºåÂÜ†‰∫ûËªçÊúâÂπæÁ®ÆÂèØËÉΩÔºü", options: ["3Á®Æ", "4Á®Æ", "5Á®Æ", "6Á®Æ"], correct: 3, type: "combination", spell: "Á´∂Ë≥ΩÈ†êË®Ä", power: 3 },
            
            // Êï∏ÊÑü (4È°å) - È≠îÊ≥ïÊï∏Â≠óÊÑüÁü•
            { category: "üî¢ Êï∏ÊÑü", color: "bg-teal-100 border-teal-400", question: "ÊúÄÂº∑Â§ßÁöÑÈ≠îÊ≥ïÂÄº999ÔºåÊúÄÊé•ËøëÂ§öÂ∞ëÔºü", options: ["900", "950", "1000", "1050"], correct: 2, type: "number_sense", spell: "Êï∏ÂÄºÊÑüÊáâ", power: 2 },
            { category: "üî¢ Êï∏ÊÑü", color: "bg-teal-100 border-teal-400", question: "È≠îËó•ÈÖçÊñπÔºö2/3ÊùØÈæçË°ÄÔºåÊØî1/2ÊùØÂ§öÈÇÑÊòØÂ∞ëÔºü", options: ["Â§ö", "Â∞ë", "‰∏ÄÊ®£", "ÁÑ°Ê≥ïÊØîËºÉ"], correct: 0, type: "number_sense", spell: "ÂàÜÊï∏È≠îÊ≥ï", power: 2 },
            { category: "üî¢ Êï∏ÊÑü", color: "bg-teal-100 border-teal-400", question: "Áî®Êï∏Â≠ó3„ÄÅ7„ÄÅ2ÊéíÂá∫ÊúÄÂ§ßÁöÑÈ≠îÊ≥ïÊï∏Â≠óÔºü", options: ["237", "327", "723", "732"], correct: 3, type: "number_sense", spell: "Êï∏Â≠óÊéíÂàó", power: 2 },
            { category: "üî¢ Êï∏ÊÑü", color: "bg-teal-100 border-teal-400", question: "Â∑´Â∏´Â°îÈ´ò49.8ÂÖ¨Â∞∫ÔºåÁ¥ÑÁ≠âÊñºÂπæÂÖ¨Â∞∫Ôºü", options: ["40ÂÖ¨Â∞∫", "45ÂÖ¨Â∞∫", "50ÂÖ¨Â∞∫", "55ÂÖ¨Â∞∫"], correct: 2, type: "number_sense", spell: "‰º∞ÁÆóÈ≠îÊ≥ï", power: 2 }
        ];

        const appContainer = document.getElementById('app');

        // Handle answer selection
        function handleAnswer(selectedIndex) {
            answers[currentQuestionIndex] = selectedIndex;
            
            // Á≠îÂ∞çÁç≤ÂæóÈ≠îÊ≥ïËÉΩÈáèÂíåÂ≠∏ÁøíÂííË™û
            if (selectedIndex === questions[currentQuestionIndex].correct) {
                magicPower += questions[currentQuestionIndex].power || 1;
                if (!spellsLearned.includes(questions[currentQuestionIndex].spell)) {
                    spellsLearned.push(questions[currentQuestionIndex].spell);
                }
                // ÁâπÊÆäÊàêÂ∞±ÔºöË£Ω‰ΩúÈ≠îËó•
                if (questions[currentQuestionIndex].type === 'application' || questions[currentQuestionIndex].type === 'algebra') {
                    potionsCreated++;
                }
            }
            
            renderApp();

            if (currentQuestionIndex < questions.length - 1) {
                setTimeout(() => {
                    currentQuestionIndex++;
                    renderApp();
                }, 1600);
            } else {
                setTimeout(() => {
                    showResult = true;
                    renderApp();
                }, 1600);
            }
        }

        // Restart quiz
        function restartQuiz() {
            currentQuestionIndex = 0;
            answers = {};
            showResult = false;
            startTime = Date.now();
            magicPower = 0;
            spellsLearned = [];
            potionsCreated = 0;
            renderApp();
        }

        // Calculate results
        function calculateResults() {
            const results = {
                calculation: { correct: 0, total: 0 },
                geometry: { correct: 0, total: 0 },
                application: { correct: 0, total: 0 },
                algebra: { correct: 0, total: 0 },
                combination: { correct: 0, total: 0 },
                number_sense: { correct: 0, total: 0 }
            };

            questions.forEach((question, index) => {
                const type = question.type;
                results[type].total++;
                if (answers[index] === question.correct) {
                    results[type].correct++;
                }
            });

            return results;
        }

        // Main render function
        function renderApp() {
            // Magic theme gradient background
            document.body.className = 'magic-bg';

            if (showResult) {
                renderResultScreen();
            } else {
                renderQuestionScreen();
            }
        }

        // Render question screen
        function renderQuestionScreen() {
            const question = questions[currentQuestionIndex];
            const selectedAnswer = answers[currentQuestionIndex];
            const isAnswered = selectedAnswer !== undefined;

            const optionsHtml = question.options.map((option, index) => {
                let buttonClass = 'bg-white bg-opacity-90 border-purple-300 text-purple-800 hover:shadow-xl cursor-pointer hover:bg-opacity-100 magic-glow';
                let icon = '';

                if (isAnswered) {
                    if (index === question.correct) {
                        buttonClass = 'bg-green-200 border-green-500 text-green-800 shadow-xl spell-cast';
                        icon = '<span class="inline-block ml-2">‚ú®</span>';
                    } else if (index === selectedAnswer) {
                        buttonClass = 'bg-red-200 border-red-500 text-red-800';
                        icon = '<span class="inline-block ml-2">üí´</span>';
                    } else {
                        buttonClass = 'bg-gray-100 border-gray-300 text-gray-500 opacity-60';
                    }
                }

                return `
                    <button
                        onclick="${isAnswered ? '' : `handleAnswer(${index})`}"
                        ${isAnswered ? 'disabled' : ''}
                        class="p-4 sm:p-5 rounded-2xl option-text font-bold border-3 transition-all duration-300 transform hover:scale-105 ${buttonClass}"
                    >
                        ${option} ${icon}
                    </button>
                `;
            }).join('');

            // È≠îÊ≥ïÈÄ≤Â∫¶Ê¢ù
            const magicProgress = ((currentQuestionIndex + 1) / questions.length) * 100;

            appContainer.innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <!-- Magic Academy Header -->
                    <div class="text-center mb-4">
                        <div class="inline-block bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-full font-bold text-xl shadow-lg magic-glow">
                            <span class="wand-sparkle inline-block">ü™Ñ</span> Êï∏Â≠∏È≠îÊ≥ïÂ≠∏Èô¢ <span class="wand-sparkle inline-block">üåü</span>
                        </div>
                    </div>

                    <!-- Magic Power Display -->
                    <div class="text-center mb-4 flex justify-center gap-4">
                        <span class="inline-block bg-purple-200 text-purple-800 px-4 py-2 rounded-full font-bold">
                            ‚ö° È≠îÊ≥ïËÉΩÈáèÔºö${magicPower}
                        </span>
                        <span class="inline-block bg-pink-200 text-pink-800 px-4 py-2 rounded-full font-bold">
                            üìú ÂííË™ûÔºö${spellsLearned.length}
                        </span>
                    </div>

                    <!-- Magic Progress Bar -->
                    <div class="relative mb-6">
                        <div class="bg-white bg-opacity-20 rounded-full p-2">
                            <div class="bg-gradient-to-r from-purple-400 via-pink-400 to-purple-400 rounded-full h-4 transition-all duration-700 relative overflow-hidden"
                                 style="width: ${magicProgress}%">
                                <div class="absolute inset-0 bg-white opacity-30 animate-pulse"></div>
                            </div>
                        </div>
                        <div class="absolute -top-2 transition-all duration-700" style="left: ${Math.max(2, magicProgress - 2)}%">
                            <span class="text-3xl wand-sparkle">ü™Ñ</span>
                        </div>
                    </div>

                    <div class="text-center text-white drop-shadow-lg text-xl mb-4 font-bold">
                        üéì Á¨¨ ${currentQuestionIndex + 1} Ë™≤ / ÂÖ± ${questions.length} Ë™≤
                    </div>

                    <!-- Question Card -->
                    <div class="${question.color} rounded-3xl shadow-2xl p-6 sm:p-8 border-4 transform hover:rotate-1 transition-all duration-300 relative overflow-hidden">
                        <div class="absolute top-2 right-2 bubble-float text-4xl opacity-30">ü´ß</div>
                        
                        <div class="text-center mb-6">
                            <div class="text-2xl sm:text-3xl font-bold text-gray-700 mb-4 flex items-center justify-center gap-2">
                                <span>${question.category}</span>
                            </div>
                            <div class="question-text font-bold text-gray-800 mb-6 min-h-[6rem] flex items-center justify-center">
                                ${question.question}
                            </div>
                        </div>

                        <!-- Answer Options -->
                        <div class="grid grid-cols-2 gap-4">
                            ${optionsHtml}
                        </div>

                        ${isAnswered ? `
                            <div class="mt-6">
                                <div class="text-center text-3xl sm:text-4xl font-bold mb-2">
                                    ${selectedAnswer === question.correct ? 
                                        `‚ú® ÂííË™ûÊàêÂäüÔºÅÂ≠∏ÊúÉ„Äå${question.spell}„Äç` 
                                        : "üåô ÂÜçË©¶‰∏ÄÊ¨°È≠îÊ≥ïÔºÅ"}
                                </div>
                                ${selectedAnswer === question.correct ? `
                                    <div class="text-center text-xl text-purple-600 font-bold">
                                        +${question.power} È≠îÊ≥ïËÉΩÈáè ‚ö°
                                    </div>
                                ` : ''}
                                <div class="text-center text-lg text-gray-600 mt-2 font-semibold">
                                    ${currentQuestionIndex < questions.length - 1 ? 'Ê∫ñÂÇô‰∏ã‰∏ÄÂ†ÇÈ≠îÊ≥ïË™≤...' : 'ÂÆåÊàêÊâÄÊúâË™≤Á®ãÔºåÁµ±Ë®àÈ≠îÊ≥ïÊàêÂ∞±...'}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }
        
        // Render result screen
        function renderResultScreen() {
            const results = calculateResults();
            const totalCorrect = Object.values(results).reduce((sum, r) => sum + r.correct, 0);
            const totalQuestions = questions.length;
            const scorePercentage = totalCorrect / totalQuestions;
            const timeTaken = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            
            let resultEmoji = "üîÆ";
            let resultMessage = "ÂÆåÊàêÈ≠îÊ≥ïË®ìÁ∑¥ÔºÅ";
            let wizardTitle = "È≠îÊ≥ïÂ≠∏Âæí";

            if (scorePercentage >= 0.95) {
                resultEmoji = "üßô‚Äç‚ôÇÔ∏è";
                resultMessage = "‰Ω†ÊàêÁÇ∫‰∫ÜÂÅâÂ§ßÁöÑÈ≠îÊ≥ïÂ∏´ÔºÅ";
                wizardTitle = "Â§ßÈ≠îÊ≥ïÂ∏´";
            } else if (scorePercentage >= 0.85) {
                resultEmoji = "üé©";
                resultMessage = "ÂÑ™ÁßÄÁöÑÈ≠îÊ≥ïË°®ÁèæÔºÅ";
                wizardTitle = "È´òÁ¥öÂ∑´Â∏´";
            } else if (scorePercentage >= 0.7) {
                resultEmoji = "ü™Ñ";
                resultMessage = "È≠îÊ≥ïÊäÄËÉΩÊèêÂçá‰∏≠ÔºÅ";
                wizardTitle = "Ë¶ãÁøíÂ∑´Â∏´";
            } else if (scorePercentage >= 0.5) {
                resultEmoji = "üìö";
                resultMessage = "ÁπºÁ∫åÂ≠∏ÁøíÈ≠îÊ≥ïÂêßÔºÅ";
                wizardTitle = "È≠îÊ≥ïÊñ∞Êâã";
            }

            // ÁâπÊÆäÊàêÂ∞±
            const achievements = [];
            if (magicPower >= 70) achievements.push("‚ö° È≠îÂäõÂÖÖÊ≤õ");
            if (spellsLearned.length >= 15) achievements.push("üìú ÂííË™ûÂ§ßÂ∏´");
            if (potionsCreated >= 5) achievements.push("üß™ È≠îËó•Â∞àÂÆ∂");
            if (scorePercentage === 1) achievements.push("‚ú® ÂÆåÁæéÈ≠îÊ≥ïÂ∏´");
            if (timeTaken < 420) achievements.push("‚è±Ô∏è Âø´ÈÄüÊñΩÊ≥ïËÄÖ");

            const categoryResultsHtml = Object.keys(results).map(key => {
                const categoryMap = {
                    calculation: { name: "üßÆ Ë®àÁÆó", icon: "üî¢", style: "bg-purple-50 border-purple-300 text-purple-700", gradient: "from-purple-400 to-pink-400" },
                    geometry: { name: "üî∫ Âπæ‰Ωï", icon: "üìê", style: "bg-indigo-50 border-indigo-300 text-indigo-700", gradient: "from-indigo-400 to-blue-400" },
                    application: { name: "üõí ÊáâÁî®", icon: "üß™", style: "bg-pink-50 border-pink-300 text-pink-700", gradient: "from-pink-400 to-rose-400" },
                    algebra: { name: "üé® ‰ª£Êï∏", icon: "‚ú¶", style: "bg-amber-50 border-amber-300 text-amber-700", gradient: "from-amber-400 to-yellow-400" },
                    combination: { name: "üß© ÁµÑÂêà", icon: "üé≤", style: "bg-emerald-50 border-emerald-300 text-emerald-700", gradient: "from-emerald-400 to-green-400" },
                    number_sense: { name: "üî¢ Êï∏ÊÑü", icon: "üîÆ", style: "bg-teal-50 border-teal-300 text-teal-700", gradient: "from-teal-400 to-cyan-400" },
                };
                const info = categoryMap[key];
                const percentage = results[key].total > 0 ? Math.round((results[key].correct / results[key].total) * 100) : 0;
                const mastery = percentage === 100 ? "Á≤æÈÄö" : percentage >= 75 ? "ÁÜüÁ∑¥" : percentage >= 50 ? "Â≠∏Áøí‰∏≠" : "ÂàùÂ≠∏";
                
                return `
                    <div class="${info.style} p-4 rounded-2xl border-2 transform hover:scale-105 transition-all duration-200 relative overflow-hidden hover:shadow-lg">
                        <div class="absolute top-1 right-1 text-2xl">${info.icon}</div>
                        <div class="text-lg font-bold">${info.name}</div>
                        <div class="text-2xl font-bold mt-1">${results[key].correct}/${results[key].total}</div>
                        <div class="text-sm">ÊéåÊè°Â∫¶Ôºö${mastery}</div>
                        <div class="mt-2 bg-gray-200 rounded-full h-3">
                            <div class="bg-gradient-to-r ${info.gradient} h-3 rounded-full transition-all duration-1000" 
                                 style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');

            appContainer.innerHTML = `
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white bg-opacity-95 rounded-3xl shadow-2xl p-8 text-center border-4 border-purple-400 magic-glow">
                        <div class="text-8xl mb-4">${resultEmoji}</div>
                        
                        <h2 class="text-4xl font-bold text-gray-800 mb-2">È≠îÊ≥ïË®ìÁ∑¥ÂÆåÊàêÔºÅ</h2>
                        
                        <div class="inline-block bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-full font-bold text-xl mb-6 shadow-lg">
                            üéì ${wizardTitle} üéì
                        </div>
                        
                        <!-- ‰∏ªË¶ÅÊàêÁ∏æ -->
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="bg-gradient-to-br from-purple-100 to-pink-100 rounded-2xl p-4">
                                <div class="text-3xl mb-1">üìú</div>
                                <div class="text-sm text-gray-600">Ê≠£Á¢∫ÊñΩÊ≥ï</div>
                                <div class="text-2xl font-bold text-purple-700">${totalCorrect}/${totalQuestions}</div>
                            </div>
                            <div class="bg-gradient-to-br from-blue-100 to-indigo-100 rounded-2xl p-4">
                                <div class="text-3xl mb-1">‚ö°</div>
                                <div class="text-sm text-gray-600">È≠îÊ≥ïËÉΩÈáè</div>
                                <div class="text-2xl font-bold text-indigo-700">${magicPower}Èªû</div>
                            </div>
                            <div class="bg-gradient-to-br from-amber-100 to-orange-100 rounded-2xl p-4">
                                <div class="text-3xl mb-1">‚è≥</div>
                                <div class="text-sm text-gray-600">ÊñΩÊ≥ïÊôÇÈñì</div>
                                <div class="text-2xl font-bold text-orange-700">${minutes}:${seconds.toString().padStart(2, '0')}</div>
                            </div>
                        </div>

                        <!-- È≠îÊ≥ïÊõ∏Êî∂ÈõÜ -->
                        <div class="mb-6 p-4 bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl">
                            <div class="text-lg font-bold text-gray-700 mb-3">üìö Â≠∏ÊúÉÁöÑÂííË™ûÔºà${spellsLearned.length}ÂÄãÔºâ</div>
                            <div class="flex flex-wrap justify-center gap-2">
                                ${spellsLearned.map(spell => `
                                    <span class="inline-block bg-white px-3 py-1 rounded-full text-sm font-bold shadow-md">
                                        ‚ú® ${spell}
                                    </span>
                                `).join('')}
                            </div>
                        </div>

                        <!-- ÊàêÂ∞±ÂæΩÁ´† -->
                        ${achievements.length > 0 ? `
                            <div class="mb-6">
                                <div class="text-lg font-bold text-gray-700 mb-3">üèÜ È≠îÊ≥ïÊàêÂ∞±</div>
                                <div class="flex flex-wrap justify-center gap-3">
                                    ${achievements.map(achievement => `
                                        <span class="inline-block bg-gradient-to-r from-yellow-200 to-orange-200 px-4 py-2 rounded-full text-sm font-bold shadow-md">
                                            ${achievement}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <!-- ÂêÑÁßëÁõÆË°®Áèæ -->
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6">
                           ${categoryResultsHtml}
                        </div>

                        <div class="text-2xl mb-6 font-bold text-gray-700">
                            ${resultMessage}
                        </div>

                        <button
                            onclick="restartQuiz()"
                            class="bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:shadow-lg transform hover:scale-105 transition-all duration-200 magic-glow"
                        >
                            ÂÜçÊ¨°ÊñΩÂ±ïÈ≠îÊ≥ï ü™Ñ
                        </button>
                    </div>
                </div>
            `;
        }

        // Start the quiz
        renderApp();

    </script>
</body>
</html>